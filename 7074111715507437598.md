---
link: https://juejin.cn/post/7074111715507437598
title: monorepoç®¡ç†æ–¹æ¡ˆï¼šåˆ©ç”¨lernaç®¡ç†ä¸€ä¸ªå¤æ‚çš„javascripté¡¹ç›®Lerna + yarn å®ç° monorepo ç®¡ç†ğŸ‘Šrollupå®æˆ˜(äº”)ä¹‹ç”¨monorepoæ­å»ºç»„ä»¶åº“å¼€å‘ç¯å¢ƒğŸŒˆä»0åˆ°1ï¼ŒåŸºäºdumi2.0 + monorepro + pnpm æ­å»ºä¸€ä¸ªè‡ªå·±çš„ç»„ä»¶åº“lerna
description: æœ¬æ–‡æœ€å¤§ä¸åŒæ˜¯æ¯ä¸€æ­¥éƒ½ä¼šæœ‰è¯¦ç»†commitå¸®åŠ©ä½ å®ç°ä»£ç ï¼ŒçŸ¥è¯†æ¶‰åŠ`lerna`ï¼Œ`ä»£ç æ„å»º`åŠ`dumi` æ–‡æœ«æœ‰é“¾æ¥
keywords: å‰ç«¯
author: é¦–é¡µ é¦–é¡µ Bot æ²¸ç‚¹ è¯¾ç¨‹ ç›´æ’­ æ´»åŠ¨ ç«èµ› å•†åŸ App æ’ä»¶ æœç´¢å†å² æ¸…ç©º åˆ›ä½œè€…ä¸­å¿ƒ å†™æ–‡ç«  å‘æ²¸ç‚¹ å†™ç¬”è®° å†™ä»£ç  è‰ç¨¿ç®± åˆ›ä½œçµæ„Ÿ æŸ¥çœ‹æ›´å¤š ä¼šå‘˜ ç™»å½• æ³¨å†Œ
date: 2022-03-12T07:27:20.000Z
publisher: ç¨€åœŸæ˜é‡‘
stats: paragraph=49 sentences=37, words=210
---
> æœ¬æ–‡æœ€å¤§ä¸åŒæ˜¯æ¯ä¸€æ­¥éƒ½ä¼šæœ‰è¯¦ç»†commitå¸®åŠ©ä½ å®ç°ä»£ç 

> çŸ¥è¯†æ¶‰åŠ `lerna`ï¼Œ `&#x4EE3;&#x7801;&#x6784;&#x5EFA;`åŠ `dumi` æ–‡æœ«æœ‰é“¾æ¥ [github](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbitsu567%2Fcubee "https://github.com/bitsu567/cubee")

### åŸºç¡€dumiè„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®

* åˆ›å»ºç›®å½•

```bash
mkdir dirName && cd dirName
```
* è„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®

```sql
yarn create @umijs/dumi-lib
```

å› ä¸ºdumiè„šæ‰‹æ¶æœ¬èº« **ä¸æ”¯æŒlernaæ¨¡å¼** éœ€è¦æˆ‘ä»¬ä½¿ç”¨lernaåˆå§‹åŒ–ä¸€é(å…ˆç”¨lernaåˆå§‹åŒ–ï¼Œdumiä¼šè¦†ç›–æ‰éƒ¨åˆ†package.jsonçš„é…ç½®ï¼‰

### æ¥å…¥lerna

* å…¨å±€å®‰è£…lerna

```css
npm i -g lerna
```
* åˆå§‹åŒ–

```csharp
lerna init
```
* ä¿®æ”¹lerna.json

```json
{
  ...

  "npmClient": "yarn",
  "useWorkspaces": true,
  "version": "independent"
}
```
* ä¿®æ”¹package.json

```json
{
  ...

  "workspaces": ["packages/*"],
}
```

### åŸºäºlernaåˆ›å»ºå­åŒ…

ç”±äºyarnå’Œlernaåœ¨åŠŸèƒ½ä¸Šæœ‰è¾ƒå¤šçš„é‡å ,æˆ‘ä»¬é‡‡ç”¨yarnå®˜æ–¹æ¨èçš„åšæ³•,ç”¨yarnæ¥å¤„ç†ä¾èµ–é—®é¢˜ï¼Œç”¨lernaæ¥å¤„ç†å‘å¸ƒé—®é¢˜ã€‚èƒ½ç”¨yarnåšçš„å°±ç”¨yarnåšå§

> Jest relies on Yarn to bootstrap the project, and on Lerna for running the publish command(s).

* åˆ é™¤æ ¹ç›®å½•src(dumiè„šæ‰‹æ¶åˆ›å»ºçš„demoï¼‰
* åˆ›å»ºå­åŒ…(ç¤¾åŒºä¼˜ç§€å®è·µ@é¡¹ç›®å/å­åŒ…åï¼Œæ–¹ä¾¿npmä¸Šç®¡ç†)

```java

lerna create /components
lerna craete /utils
```

### å®Œå–„å­åŒ…ä»£ç åŠæ–‡æ¡£

* æ·»åŠ å­åŒ…é—´ä¾èµ–ï¼Œ@cube/componentsä¾èµ–@cube/utils

```kotlin

yarn workspace /components add /utils@1.0.0
```
* ç¼–å†™ç»„ä»¶ä»£ç ã€demoä»£ç åŠæ–‡æ¡£ è¿™æ—¶å€™æ‰§è¡Œ `yarn` `yarn start`åº”è¯¥èƒ½çœ‹è§æ–‡æ¡£ç½‘ç«™èƒ½æ­£å¸¸è¿è¡Œäº†

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0806cef7b6a04b18b6626b4a3d7875ed~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?) å»ºè®®é˜…è¯» [dumiæ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Fd.umijs.org%2Fzh-CN%2Fguide "https://d.umijs.org/zh-CN/guide")(åŒ…æ‹¬æ–‡æ¡£è·¯ç”±ã€demoä¸­å¼•ç”¨ç»„ä»¶ç­‰) ![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fc46342576f4e518eae3ebae8dbb599~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)è™½ç„¶ä»£ç èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯è¿™æ—¶å€™demoä¸­tsè¿˜æ˜¯ä¼šæç¤ºé”™è¯¯

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7f2a8d213b34de98afeae20ed18280e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ„å»ºï¼Œtsä»package.jsoné…ç½®çš„å…¥å£æ–‡ä»¶ä¸­æ‰¾ä¸åˆ°ä»£ç 

### åŸºäºfather-buildæ„å»º

[father](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Ffather "https://github.com/umijs/father")æ˜¯dumiçš„æ‰“åŒ…å·¥å…·ï¼Œåœ¨dumiåˆå§‹åŒ–é¡¹ç›®æ—¶å·²ç»å®‰è£…ã€‚ æ˜¯ä¸€æ¬¾åŸºäºrollup å’Œ babel çš„ç»„ä»¶æ‰“åŒ…å·¥å…·ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯¦è§æ–‡æ¡£ã€‚ è¿™é‡Œæˆ‘ä»¬åªåŸºäºbabelæ‰“åŒ…

* ä¿®æ”¹.fatherrc.ts

```arduino
export default {
  esm: 'babel',
  pkgs: ['utils', 'components'],
}

```
* åˆ†åˆ«ä¿®æ”¹å­åŒ…package.json

```json
{
    ...

    "module": "es/index.js",
    "typings": "es/index.d.ts",
    "files": [
      "lib",
      "es"
    ]
}
```
* å†é‡æ–°æ‰“å¼€æ–‡ä»¶ï¼ŒTSå°†ä¸å†æŠ¥é”™ï¼ˆæœ‰æ—¶å€™è¦é‡å†™å¼•å…¥è¯­å¥ï¼Œè®©TSé‡æ–°æŸ¥æ‰¾ç›®æ ‡æ–‡ä»¶ï¼‰

### åŸºäºlernaå‘å¸ƒç‰ˆæœ¬

æ­å–œä½ ç»ˆäºåˆ°æœ€åä¸€æ­¥äº† æˆ‘ä»¬å°†ä½¿ç”¨lernaå®Œæˆå‘å¸ƒ lerna publishæŒ‡ä»¤ä¼šåšä¸¤ä»¶äº‹

1. ç”Ÿæˆchangelogï¼Œæ”¹å˜éœ€è¦å‘å¸ƒå­åŒ…versionï¼Œæ¨é€ä»£ç å’Œtagåˆ°è¿œç«¯ä»“åº“
2. æ„å»ºä»£ç ï¼Œå‘å¸ƒåˆ°npm æˆ‘ä»¬è¿˜éœ€è¦åšä»¥ä¸‹äº‹æƒ…

* é¦–å…ˆå°†ä»£ç æ¨åˆ°gitè¿œç«¯ä»“åº“
* åœ¨npmå®˜ç½‘ä¸Šéœ€è¦æ·»åŠ ç»„ç»‡ä»¥å­˜æ”¾å¸¦ä½œç”¨åŸŸçš„åŒ…

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ee6a21b1840476788c0dbb4ae2d9c82~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

* é…ç½®lerna.json

```json
{
  ...

  "command": {
    "publish": {
      "registry": "https://registry.npmjs.org/"
    },
    "version": {
      "conventionalCommits": true,
      "message": "chore(release): publish"
    }
  }
}
```

* åˆ†åˆ«ä¿®æ”¹å­åŒ…package.json

```json
{
  ...

  "repository": {
    "type": "git",
    "url": "https://github.com/bitsu567/cubee"
  },
}
```

* ç™»å½•npm `npm login`
* å‘å¸ƒ `lerna publish`

ç„¶åå°±å¯ä»¥åœ¨ä½ çš„é¡¹ç›®ä¸­å¼•ç”¨äº†ï¼ ä¸ºäº†ä¸æ±¡æŸ“npmç¯å¢ƒï¼Œæµ‹è¯•åŒ…å¯ä»¥è‡ªå·±åŸºäºverdaccioæ­å»ºnpmç¯å¢ƒï¼Œæˆ–è€…å°½é‡72å°æ—¶å†…åˆ é™¤é¡¹ç›®~

å‚è€ƒ

* [ç°ä»£å‰ç«¯å·¥ç¨‹ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç¦»ä¸å¼€ Monorepo](https://juejin.cn/post/6944877410827370504 "https://juejin.cn/post/6944877410827370504")
* [åŸºäºlernaå’Œyarn workspaceçš„monorepoå·¥ä½œæµ](https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F71385053 "https://zhuanlan.zhihu.com/p/71385053")
* [lerna+yarn workspace+monorepoé¡¹ç›®çš„æœ€ä½³å®è·µ](https://juejin.cn/post/6844903918279852046 "https://juejin.cn/post/6844903918279852046")
