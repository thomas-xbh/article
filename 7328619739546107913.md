---
link: https://juejin.cn/post/7328619739546107913
title: ä½¿ç”¨pnpmåšmonorepoåŸºäºLerna æ­å»ºè„šæ‰‹æ¶ï¼šä»åˆå§‹åŒ–åˆ°å‘å¸ƒğŸš€Turborepoï¼šå‘å¸ƒå½“æœˆå°±æ¿€å¢ 3.8k Starï¼Œè¿™æ¬¾è¶…ç¥çš„æ–°å…´ Monorepo æ–¹æ¡ˆï¼Œä½ ä¸æ‰“ç®—å°è¯•ä¸‹å—ï¼Ÿä¸ºä»€ä¹ˆè¶Šæ¥è¶Šå¤šçš„é¡¹ç›®é€‰æ‹© Monorepoï¼ŸåŸºäº Lerna ç®¡ç† packages çš„ Monorepo é¡¹ç›®æœ€ä½³å®è·µ
description: lernaæ˜¯ä¸€ä¸ªè‘—åçš„åŒ…ç®¡ç†å™¨ï¼Œæœ¬æ–‡å®Œæ•´çš„å¸¦ä½ ä»0åˆ°1ï¼ŒæŒæ¡lernaçš„ç”¨æ³•ï¼ç›¸ä¿¡ä½ çœ‹å®Œä¹‹åä¸€å®šå¤§æœ‰æ”¶è·ï¼
keywords: å‰ç«¯
author: é¦–é¡µ é¦–é¡µ Bot æ²¸ç‚¹ è¯¾ç¨‹ ç›´æ’­ æ´»åŠ¨ ç«èµ› å•†åŸ App æ’ä»¶ æœç´¢å†å² æ¸…ç©º åˆ›ä½œè€…ä¸­å¿ƒ å†™æ–‡ç«  å‘æ²¸ç‚¹ å†™ç¬”è®° å†™ä»£ç  è‰ç¨¿ç®± åˆ›ä½œçµæ„Ÿ æŸ¥çœ‹æ›´å¤š ä¼šå‘˜ ç™»å½• æ³¨å†Œ
date: 2024-01-27T18:27:59.000Z
publisher: ç¨€åœŸæ˜é‡‘
stats: paragraph=132 sentences=53, words=366
---
### å‰è¨€

`lerna`æ˜¯ä¸€ä¸ªè‘—åçš„åŒ…ç®¡ç†å™¨ï¼Œè™½ç„¶ç°åœ¨ `pnpm`çš„ `monorepo`ç«çš„ä¸€å¡Œç³Šæ¶‚ï¼Œä½†æ˜¯æˆ‘è®¤ä¸º `lerna`è¿˜æ˜¯ç›¸å¯¹æˆç†Ÿä¸€äº›ï¼Œæ¯•ç«Ÿ `@vue/cli`ã€ `create-react-app`ã€ `babel`ç­‰éƒ½æ˜¯ä½¿ç”¨ `lerna`è¿›è¡Œç®¡ç†ã€‚åŒæ—¶ `lerna`æœ‰å®Œæ•´çš„ç¤¾åŒºï¼Œè‡³ä»Šä¹Ÿå·²ç»å‘å±•åˆ° `8.x`çš„ç‰ˆæœ¬ï¼Œ2024å¹´ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦å­¦ä¹ å’ŒæŒæ¡è¿™é—¨æŠ€æœ¯çš„ï¼

### å¼€å§‹

#### lerna init åˆå§‹åŒ–é¡¹ç›®

åˆ›å»ºä¸€ä¸ªé¡¹ç›®

```cmd
cd Desktop && mkdir lerna-demo
```

è¿›å…¥é¡¹ç›®åï¼Œä½¿ç”¨ `npm`é¡¹ç›®åˆå§‹åŒ–é¡¹ç›®

```cmd
cd lerna-demo
npm init -y
```

å…¨å±€å®‰è£… `lerna`

```cmd
npm install lerna -g
```

ä½¿ç”¨ `vscode`æ‰“å¼€é¡¹ç›®åï¼Œä½¿ç”¨ `lerna`åˆå§‹åŒ–

```cmd
lerna init
```

è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç°æ§åˆ¶å°æŠ¥é”™äº†

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51bef3af9899424ca77c6ac28290ce7e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2040&h=448&s=99589&e=png&b=181818)

ç½‘ä¸Šå¤§éƒ¨åˆ†èµ„æ–™éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ `lerna init`å°±å¯ä»¥åˆå§‹åŒ–é¡¹ç›®ï¼Œä½†æ˜¯æ–°ç‰ˆçš„ `lerna`ï¼ˆ `8.0`ç‰ˆæœ¬ï¼‰è„šæ‰‹æ¶éœ€è¦åŠ ä¸Š `--packages`çš„ `option`ï¼Œè¯¦æƒ…å¯ä»¥çœ‹[å®˜æ–¹æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Flerna.js.org%2Fdocs%2Fgetting-started%23adding-lerna-to-an-existing-repo "https://lerna.js.org/docs/getting-started#adding-lerna-to-an-existing-repo")

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8af834e341924d65a53d925d41b6b3d3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2020&h=308&s=65288&e=png&b=282a36)

æŒ‰ç…§æ–‡æ¡£ï¼Œæˆ‘ä»¬å†æ¬¡åˆå§‹åŒ–é¡¹ç›®

```cmd
lerna init --packages="packages/*"
```

æˆ‘ä»¬ä¼šå‘ç°ï¼Œ `lerna`è‡ªåŠ¨è¢«å®‰è£…åˆ°äº† `devDependencies`ï¼ŒåŒæ—¶ä½¿ç”¨ `git`è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œåˆ›å»ºäº† `lerna.json`é…ç½®æ–‡ä»¶ ![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5cdc3bed0234bdf9ff226add84ac26c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2402&h=1144&s=215604&e=png&b=1d1d1d)

æ‰‹åŠ¨ä¿®æ”¹ `lerna.json`ä¸­çš„ç‰ˆæœ¬å·ä¸º `1.0.0`

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a4eaf60580b4a5f874dd9e669489add~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1037&h=324&s=35290&e=png&b=1f1f1f)

#### lerna create åˆ›å»ºå­é¡¹ç›®

åˆå§‹åŒ–é¡¹ç›®åï¼Œä½¿ç”¨ `lerna create`å‘½ä»¤æ¥åˆ›å»ºå­é¡¹ç›®ï¼Œè¿™é‡Œæˆ‘åˆ›å»ºä¸€ä¸ªåä¸º `core`çš„å­é¡¹ç›®

```cmd
lerna create core
```

éœ€è¦æ³¨æ„çš„æ˜¯è¾“å…¥ `package name`æ—¶ï¼Œä¸èƒ½ç›´æ¥è¾“å…¥ `core`ï¼Œå› ä¸ºè¿™ä¸ªåŒ…ä¼šè¢«ä½œä¸ºå•ç‹¬çš„ `npm`åŒ…å‘å¸ƒï¼Œ `core`åŒåçš„åŒ…è‚¯å®šä¼šå­˜åœ¨çš„ã€‚æˆ‘ä»¬å¯ä»¥ç¾¤ç»„çš„å½¢å¼åˆ›å»ºï¼Œæœ€ç»ˆåŒ…åå°±æ˜¯ `@lerna-demo/core`ï¼Œç±»ä¼¼ `@vue/cli`ã€ `@vue/composition-api`

> å‘å¸ƒçš„å‰ææ˜¯éœ€è¦åœ¨ `npm`å®˜æ–¹ä¸­åˆ›å»ºç¾¤ç»„ï¼ˆä¾‹å¦‚ï¼š `@learn-demo`ï¼‰ï¼Œè¿™ä¸ªåé¢ä¼šè®²

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58fef6b7dacc4e00a834a41bbe33662b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2018&h=498&s=97874&e=png&b=181818)

ä¸Šé¢çš„åˆ›å»ºæ­¥éª¤å®Œæˆåï¼Œå­é¡¹ç›® `core`çš„ `package.json`å°±ä¼šæ˜¾ç¤ºå®Œæ•´çš„åŒ…å

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b5b7253ae0e41789c52b652dc86372f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1416&h=1354&s=187218&e=png&b=1f1f1f)

ç´§æ¥ç€æˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ›å»ºä¸€ä¸ª `util`å­é¡¹ç›®

```cmd
lerna create util
```

æœ€ç»ˆçš„ç›®å½•ç»“æ„å¦‚å›¾

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d889ec621d004801ab5106088171052a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1494&h=596&s=91468&e=png&b=1a1a1a)

#### lerna list æŸ¥çœ‹å­é¡¹ç›®

ä½¿ç”¨ `list`å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¢« `lerna`ç®¡ç†çš„å­é¡¹ç›®

```cmd
lerna list
or
lerna ls
```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac6410b367a14de381ded04e1d77eaff~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=669&h=388&s=74211&e=png&b=171717)

#### åºŸå¼ƒçš„lerna add

`v7`ç‰ˆæœ¬ä¹‹å‰ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥ä¸ºé¡¹ç›®å®‰è£…ä¾èµ–

```cmd
lerna add lodash //ä¸ºæ‰€æœ‰å­é¡¹ç›®å®‰è£…lodash
or
lerna add lodash --scope @lerna-demo/core //ç»™coreé¡¹ç›®å®‰è£…lodash
or
lerna add lodash --scope @lerna-demo/core --scope @lerna-demo/util ç»™coreå’Œutilå®‰è£…lodash
```

ä½†æ˜¯ä» `v7`ä¹‹åï¼Œè¿™ä¸ªå‘½ä»¤å°±è¢«åºŸå¼ƒäº†ï¼Œè¯¦æƒ…è§[å®˜æ–¹æ–‡æ¡£](https://link.juejin.cn?target=https%3A%2F%2Flerna.js.org%2Fdocs%2Flegacy-package-management "https://lerna.js.org/docs/legacy-package-management")

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3186da7db7134f518f06175e0c3a9f82~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1327&h=188&s=37424&e=png&b=181818)

ç”±äºæˆ‘ä»¬å®‰è£…çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ `v8.x`ï¼Œæ‰€ä»¥æ— æ³•ç»§ç»­ä½¿ç”¨è¿™ä¸ªå‘½ä»¤

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8257d76738e4ab78a6b30300a1fd11b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=657&h=99&s=16405&e=png&b=181818)

æˆ‘ä»¬å¦‚æœæƒ³ç»™é¡¹ç›®å®‰è£…ä¾èµ–ï¼Œä½¿ç”¨åŸæ¥çš„ `npm/yarn/pnpm`å³å¯

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9c9cd01c4b9436782777fadf7c6b266~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2630&h=1456&s=357720&e=png&b=f9fafc)

æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬åªéœ€è¦åŠ ä¸Š `-w`æ ‡è¯†å³å¯

```cmd
npm install lodash -w packages/core
or
npm install lodash -w packages/core -w packages/util
```

ç»†å¿ƒçš„åŒå­¦å‘ç°ï¼Œå®‰è£…åè™½ç„¶æ˜¾ç¤ºäº†å®‰è£…æˆåŠŸï¼Œä½†æ˜¯ `core`æˆ–è€… `util`ç›®å½•ä¸‹éƒ½æ²¡æœ‰ `node_modules`ï¼Œå®ƒæ˜¯å¦æœ‰æ­£ç¡®å®‰è£…äº†å‘¢ï¼Ÿ

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58464c19fed24ff28529babfd29917b0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1424&h=437&s=73294&e=png&b=1a1a1a)

æˆ‘ä»¬åœ¨ `core`çš„é¡¹ç›®ä¸­å°è¯•ä½¿ç”¨ `lodash`

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/30cf7c5732cd47dcb2a4ec55a273bded~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1496&h=727&s=137268&e=png&b=1b1b1b)

ä»£ç æ­£å¸¸è¿è¡Œï¼Œè¯´æ˜ `lodash`å·²ç»å®‰è£…æˆåŠŸäº†ï¼Œä½†å®é™…æ˜¯è¢«å®‰è£…åˆ°äº†æœ€å¤–å±‚çš„ `node_modules`ä¸­ã€‚è¿™å®é™…ä¹Ÿæ˜¯ `v8`ç‰ˆæœ¬åçš„æ”¹åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–éƒ½æ”¾åœ¨æœ€å¤–å±‚ï¼Œé¿å… `node_modules`çš„å·¨å‹ä½“ç§¯é—®é¢˜ã€‚

#### lerna clean æ¸…ç©ºä¾èµ–

é™¤äº†å®‰è£…ä¾èµ–ä¹‹å¤–ï¼Œå¿…ç„¶å°‘ä¸äº†æ¸…ç©ºä¾èµ–ã€‚

```cmd
lerna clean //æ¸…ç©ºæ‰€æœ‰é¡¹ç›®çš„ä¾èµ–
or
lerna clean --scope @lerna-demo/core æ¸…ç©ºcoreçš„ä¾èµ–
or
lerna clean --scope @lerna-demo/core --scope @lerna-demo/util æ¸…ç©ºcoreå’Œutilçš„ä¾èµ–
```

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ `core`å’Œ `util`é¡¹ç›®çš„ `dependencies`

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/183cdce467204bac9666ad3359b70cf5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1449&h=507&s=106016&e=png&b=1f1f1f)

æ‰§è¡Œå‘½ä»¤åï¼Œæ˜¾ç¤ºæˆåŠŸäº†ï¼Œä½†æ˜¯å‘ç° `dependencies`ä¸­ä¾ç„¶å­˜åœ¨ã€‚è¿™æ ·è®¾è®¡å¯èƒ½æ˜¯å› ä¸º `lerna`å¯èƒ½è€ƒè™‘åˆ°ç”¨æˆ·éœ€è¦é‡æ–°å®‰è£…ä¾èµ–ï¼Œæ‰€ä»¥æ²¡æœ‰åˆ é™¤ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7813741f2f384511a089c6c23d356db3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1446&h=921&s=185156&e=png&b=1d1d1d)

#### åºŸå¼ƒçš„lerna bootstrap

ä¸Šé¢æåˆ°å¯èƒ½éœ€è¦é‡æ–°å®‰è£…ä¾èµ–ï¼Œæ²¡é”™ `lerna`åœ¨ `v7`ä¹‹å‰ç¡®å®æ˜¯é€šè¿‡ `bootstrap`å‘½ä»¤å®ç°çš„

```cmd
lerna bootstrap //é‡æ–°å®‰è£…æ‰€æœ‰é¡¹ç›®çš„ä¾èµ–
or
lerna bootstrap --scope @lerna-demo/core é‡æ–°å®‰è£…coreçš„ä¾èµ–
or
lerna bootstrap --scope @lerna-demo/core --scope @lerna-demo/util é‡æ–°å®‰è£…coreå’Œutilçš„ä¾èµ–
```

ä½†æ˜¯å’Œ `add`å‘½ä»¤ä¸€æ ·ï¼Œè¿™ä¸ªå‘½ä»¤ä¹Ÿè¢«åºŸé™¤äº†

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f01531ebba14481e9b744ae82a6f92b7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1400&h=163&s=40807&e=png&b=181818)

å¦‚æœéœ€è¦é‡æ–°å®‰è£…ä¾èµ–ï¼Œç›´æ¥ä½¿ç”¨ `npm/yarn/pnpm`å³å¯, å› ä¸º `dependencies`ä¸­ä¾ç„¶å­˜åœ¨è¢« `clean`æ‰çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éšæ—¶å¯ä»¥é‡æ–°å®‰è£…è¿™äº›ä¾èµ–ã€‚

#### åºŸå¼ƒçš„lerna link

`link`å‘½ä»¤åœ¨ `v7`ç‰ˆæœ¬ä¹‹å‰è¢«ç”¨æ¥å°†å­é¡¹ç›®ä¸­ç›¸äº’ä¾èµ–çš„åŒ…éƒ½åœ¨æœ¬åœ°link æ–¹ä¾¿æœ¬åœ°è°ƒè¯•ï¼Œä¾‹å¦‚ `core`ä¸­ä¾èµ–äº† `util`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰§è¡Œï¼š

```cmd
lerna link
```

ä½†æ˜¯è¿™æ¡æŒ‡ä»¤åœ¨ `v8`å·²ç»è¢«åºŸå¼ƒäº†

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48f49906d6934dc9bbc33268aba99ef1~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1336&h=190&s=36879&e=png&b=181818)

è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥å®‰è£…å¯¹åº”çš„åŒ…åå³å¯ï¼Œ `lerna`ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºå¯¹åº”çš„è½¯é“¾

```cmd
npm install @lerna-demo/util -w packages/core
```

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09738083a6c24600b2ec709652e53725~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1121&h=281&s=42190&e=png&b=181818)

åŒæ—¶ï¼Œä¼šå®‰è£…åˆ° `core`é¡¹ç›®çš„ `node_modules`ç›®å½•ä¸‹

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cc4b98d02656462ba7e6a66a00973d1c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=405&h=386&s=31898&e=png&b=181818)

æˆ‘ä»¬å°è¯•åœ¨ `core`é¡¹ç›®ä¸­å¼•å…¥ `util`

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd3b6d1fc45b44228995aec729528b3f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1222&h=695&s=91608&e=png&b=1b1b1b)

æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œåœ¨ `core`ä¸­å¯ä»¥é¡ºåˆ©è°ƒç”¨ `util`

#### @lerna/legacy-package-management

å¦‚æœä½ ç¡®å®å¾ˆéœ€è¦ `add`ã€ `boostrap`ã€ `link`ï¼Œæˆ–è€…æ—§ç‰ˆçš„ `lerna`å‡çº§åˆ°äº†æœ€æ–°ä¸ºäº†é€‚é…ï¼Œå¯ä»¥å®‰è£… `@lerna/legacy-package-management`æ¥è§£å†³ï¼Œè¿™ä¸ªåŒ…ä¿ç•™äº†è¿™ä¸‰ä¸ªå‘½ä»¤çš„ä½¿ç”¨

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5fcb25951004b92a7025e7d47a76842~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1986&h=696&s=223655&e=png&b=f8f9fb)

æˆ‘ä»¬å®‰è£…ä¸€ä¸‹è¿™ä¸ªåŒ…ï¼š

```cmd
npm install @lerna/legacy-package-management -D
```

è¯•ä¸€ä¸‹ `lerna add`

```cmd
lerna add axios //åŒæ—¶å®‰è£…axiosåˆ°coreå’Œutil
```

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5acde23c5cc045f2ab4fff429eb9a36e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1447&h=836&s=189408&e=png&b=1d1d1d)

æ­¤æ—¶ï¼Œ `core`å’Œ `util`éƒ½å®‰è£…äº† `axios`ä¾èµ–ï¼Œè¯´æ˜è¿™ä¸ªåŒ…åˆå…¼å®¹äº†åºŸå¼ƒçš„æŒ‡ä»¤ï¼Œè¿™å¯¹é‚£äº›å‡çº§ `lerna`éœ€è¦å…¼å®¹çš„åŒå­¦æ˜¯æ¯”è¾ƒå‹å¥½çš„ã€‚å¦å¤–ä¸¤ä¸ªå‘½ä»¤æˆ‘å°±ä¸è¯•äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚

#### lerna exec æ‰§è¡Œç»ˆç«¯å‘½ä»¤

ä½¿ç”¨è¿‡ `node`çš„ `child_process`å‘½ä»¤çš„åŒå­¦å¯¹ `exec`è¿™ä¸ªæ–¹æ³•åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œ `lerna exec`ä¹Ÿæ˜¯ç”¨æ¥ä»£æ›¿åšåŒæ ·çš„äº‹æƒ…ï¼Œè€Œè¿™ä¸ªä¸Šä¸‹æ–‡æ­£æ˜¯ `packages`ç›®å½•ä¸‹ç®¡ç†çš„å­é¡¹ç›®ï¼Œå¹¶éæ˜¯æ ¹ç›®å½•ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„

```cmd
lerna exec ls //æŸ¥çœ‹coreå’Œutilæ‰€æœ‰æ–‡ä»¶
```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6127b3b9af741ae8259cd71d562a77d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1207&h=264&s=58936&e=png&b=171717)

```cmd
lerna exec --scope @lerna-demo/core -- rm -rf node_modules //åˆ é™¤coreçš„node_modules
```

> å…¶æ ¼å¼æ˜¯ï¼šlerna exec --scope [pkgName] -- [stream]

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67b999f0bd7646f181dc17a866c10071~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=960&h=277&s=58711&e=png&b=181818)

#### lerna run æ‰§è¡Œnpm script

`run`å‘½ä»¤å’Œ `exec`å‘½ä»¤å¾ˆåƒï¼Œä¸€èˆ¬ä½¿ç”¨ `run`å‘½ä»¤å¤§éƒ½æ˜¯æ‰§è¡Œå­é¡¹ç›®ä¸­ `script`è„šæœ¬çš„å‘½ä»¤ï¼Œä¾‹å¦‚ä¸€é”®å¯åŠ¨é¡¹ç›®ï¼Œæˆ–è€…ä¸€é”®æ‰“åŒ…ç­‰ç­‰

```cmd
lerna run dev //ä¸€é”®å¯åŠ¨æ‰€æœ‰é¡¹ç›®
or
lerna run build --scope @lerna-demo/core //æ‰“åŒ…coreé¡¹ç›®
```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3ae20f11e4a4850a4d9930720b79f1a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1175&h=398&s=57842&e=png&b=181818)

å¦‚æœæœ‰æŒ‡å®š `npm/yarn/pnpm`çš„éœ€æ±‚ï¼Œä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œé€šè¿‡ `--npm-client`å³å¯ï¼Œå¯é€‰å€¼æœ‰ï¼š `npm/yarn/pnpm`

```cmd
lerna run test -- npm-client yarn //ä½¿ç”¨yarnæ¥æ‰§è¡Œtestè„šæœ¬
```

### å‘å¸ƒ

ä¸Šè¿°ä¸€ç³»åˆ—æ“ä½œåŸºæœ¬éƒ½æ˜¯åœ¨å¼€å‘é˜¶æ®µæ—¶ä½¿ç”¨çš„ï¼Œç°åœ¨æ¥è®²ä¸€ä¸‹å‘å¸ƒé˜¶æ®µå¦‚ä½•ä½¿ç”¨ `lerna`è¿›è¡Œç®¡ç†ã€‚ **ä½†æ˜¯åœ¨ä½¿ç”¨ `lerna` ä¸ºæˆ‘ä»¬å‘å¸ƒç®¡ç†ä¹‹å‰ï¼Œå‰ææ˜¯éœ€è¦å°†é¡¹ç›®ç®¡ç† `git` ä»“åº“ï¼Œè¿™ä¸ªæ˜¯å‰æï¼**

#### lerna diff æŸ¥çœ‹ç‰ˆæœ¬å·®å¼‚

ä½¿ç”¨è¿™ä¸ªå‘½ä»¤çš„å‰ææ˜¯éœ€è¦æœ‰ `commit`è®°å½•ï¼Œæ‹¿å½“å‰æ”¹åŠ¨ä¸ `commit`è¿›è¡Œæ¯”è¾ƒï¼ŒåŠŸèƒ½å’Œ `git diff`ä¸€è‡´

å°†ä¹‹å‰çš„ä»£ç æäº¤åï¼Œéšæ„ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c61436aa8b8444e8a199b106a4adfc93~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1285&h=511&s=95921&e=png&b=222222)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f08994249189450f8fa6941892cae27e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1065&h=783&s=68157&e=png&b=2c3643)

åªæœ‰æœ‰æ–‡ä»¶æ”¹åŠ¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ `diff`æŸ¥çœ‹

#### lerna version æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·

ä½¿ç”¨ `version`å‘½ä»¤å¯ä»¥æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·ï¼Œç›®å‰ `core`å’Œ `util`éƒ½æ˜¯ `1.0.0`ç‰ˆæœ¬ï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤çš„å‰ææ˜¯ä¸èƒ½æœ‰æ–‡ä»¶æ”¹åŠ¨ï¼ˆæ‰€æœ‰æ”¹åŠ¨å·²è¢«æäº¤ï¼‰

```cmd
lerna version
```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/938031f214504dcfa1d12d68509a44a3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=835&h=457&s=69773&e=png&b=181818)

æ­¤æ—¶ç‰ˆæœ¬å·å·²ç»æ›´æ–°äº†ï¼Œä½†æ˜¯æ§åˆ¶å°æŠ¥é”™äº†ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä¹‹å‰æŠŠ `packag-lock.json`åŠ å…¥åˆ°äº† `.gitignore`ä¸­

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4fe2f2e876214151bf41b2ffb5033527~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1762&h=855&s=243777&e=png&b=181818)

æˆ‘ä»¬å»æ‰ `packag-lock.json`ï¼ŒåŒæ—¶åŠ å…¥ `lerna-debug.log`ï¼Œå¹¶ä¸”æ’¤é”€ `package.json`å’Œ `lerna.json`çš„ä¿®æ”¹ï¼ŒåŒæ—¶ç”Ÿæˆä¸€æ¡æ–°çš„ `commit`è®°å½•ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d5ae2df2cd840a588e49aa5293997a7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1550&h=365&s=72283&e=png&b=1e1e1e)

å†æ¬¡æ‰§è¡Œ `lerna version`ï¼Œæ›´æ–°ç‰ˆæœ¬å·

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e39a5e0240674bf8a979f3afd82d4e7d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1023&h=517&s=91547&e=png&b=181818)

å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å‘è¿œç¨‹ä»“åº“æ¨é€äº† `tag`ç‰ˆæœ¬å·ï¼š `1.0.1`

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/355d8a92d3904dafaee74aef61ebf2eb~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=3190&h=1406&s=258701&e=png&b=0d1218)

#### lerna publish å‘å¸ƒ

`publish`å‘½ä»¤ä¼šå°†é¡¹ç›®å‘å¸ƒåˆ°[npm](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F "https://www.npmjs.com/")ä¸­ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œé¦–å…ˆä¼šæ‰§è¡Œä¸€é `lerna version`çš„æ“ä½œï¼Œç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯ `@lerna-demo/xxx`è¿™ç§ç¾¤ç»„çš„å½¢å¼ï¼Œå‰ææ˜¯éœ€è¦åœ¨ `npm`ä¸­åˆ›å»ºè¿™ä¸ªç¾¤ç»„

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e36895b97e549dab77f6b437f22a07a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1046&h=1080&s=108266&e=png&b=fdfbfb)

ä½†æ˜¯å¾ˆä¸å¹¸ï¼Œ `@lerna-demo`è¿™ä¸ªç¾¤ç»„å·²ç»è¢«åˆ›å»ºäº†ï¼ï¼ˆç‹—å¤´ï¼‰ï¼Œæ‰€ä»¥åé¢çš„æµç¨‹å°±æ²¡åŠæ³•æ¼”ç¤ºä¸‹å»äº†ï¼ˆæ‡’å¾—æ¢ä¸ªåå­—äº†ï¼Œå“ˆå“ˆï¼‰ã€‚åªè¦åˆ›å»ºå®Œç¾¤ç»„ä¹‹åï¼Œæ‰§è¡Œ `lerna publish`å³å¯ï¼Œä¼šåŒå‘è¿œç¨‹ä»“åº“æ¨é€æ–°çš„ `tag`æ ‡ç­¾ï¼Œå¹¶ä¸”ä¼šå‘å¸ƒåˆ° `npm`ä»“åº“ä¸­ã€‚

### å…¶å®ƒ

é™¤äº†ä¸Šè¿°å¸¸è§ç”¨æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å†·é—¨çš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `lerna -h`æŸ¥çœ‹

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12507a6c2a324b44a08c7ac7b12191bb~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1443&h=831&s=189582&e=png&b=181818)

* `lerna info` æ‰“å°æœ¬åœ°ç¯å¢ƒçš„è°ƒè¯•ä¿¡æ¯
* `lerna add-caching` ç”Ÿæˆä»»åŠ¡è¿è¡Œå™¨é…ç½®çš„äº¤äº’å¼æç¤ºç¬¦
* `lerna changed` åˆ—å‡ºè‡ªä¸Šä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç‰ˆæœ¬ä»¥æ¥å·²æ›´æ”¹çš„æœ¬åœ°åŒ…
* `lerna repair` è¿è¡Œè‡ªåŠ¨è¿ç§»ä»¥ä¿®å¤çŸ¥è¯†åº“çš„çŠ¶æ€
* `lerna watch` æ¯å½“åŒ…æˆ–å…¶ä¾èµ–é¡¹æ›´æ”¹æ—¶ï¼Œè¿è¡Œå‘½ä»¤
* `lerna import` å°†åŒ…å¯¼å…¥åˆ°å¸¦æœ‰æäº¤å†å²è®°å½•çš„ `monorepo`ä¸­

è¿™å‡ ä¸ªå‘½ä»¤å¹³æ—¶ä¸æ€ä¹ˆç”¨ï¼Œæ ¹æ®è‡ªå·±éœ€è¦çš„ä½¿ç”¨å³å¯ã€‚

### æ€»ç»“

æœ¬æ–‡ä»0åˆ°1ï¼Œå®Œæ•´çš„å¸¦ä½ ä½¿ç”¨ `leran`è¿›è¡Œå¤šåŒ…ç®¡ç†ã€‚çœ‹å®Œå…¨æ–‡ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¸€å®šæŒæ¡äº† `lerna`çš„ç”¨æ³•ï¼
