---
link: https://blog.csdn.net/lgno2/article/details/122738799
title: Chrome åˆæäº‹æƒ…ï¼Œâ€‹document.domainè·¨åŸŸç›´æ¥åºŸäº†
description: å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ æ¼«æ­¥ï¼Œä»Šå„¿ä¸ªåˆç»™å¤§å®¶æ¥åˆ†ææµè§ˆå™¨ç­–ç•¥äº†ï½å…³æ³¨å…¬ä¼—å·å‰ç«¯å¼€å‘åšå®¢ï¼Œå›å¤â€œåŠ ç¾¤â€åŠ å…¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œå¤©å¤©è¿›æ­¥å¤©å¤©å‡ºæ–°ç­–ç•¥ï¼Œä¸šåŠ¡éƒ½è¦æ”¹åºŸäº† ...ä¸€å¥è¯æè¿°document.do..._document.domain å·²å¼ƒç”¨
keywords: document.domain å·²å¼ƒç”¨
author: å‰ç«¯å¼€å‘åšå®¢ Csdnè®¤è¯åšå®¢ä¸“å®¶ Csdnè®¤è¯ä¼ä¸šåšå®¢ ç é¾„14å¹´ æš‚æ— è®¤è¯
date: 2022-01-28T07:11:15.000Z
publisher: null
stats: paragraph=55 sentences=59, words=183
---
å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ **æ¼«æ­¥** ï¼Œä»Šå„¿ä¸ªåˆç»™å¤§å®¶æ¥åˆ†ææµè§ˆå™¨ç­–ç•¥äº†ï½

å…³æ³¨å…¬ä¼—å· å‰ç«¯å¼€å‘åšå®¢ï¼Œå›å¤"åŠ ç¾¤"

åŠ å…¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œå¤©å¤©è¿›æ­¥

å¤©å¤©å‡ºæ–°ç­–ç•¥ï¼Œä¸šåŠ¡éƒ½è¦æ”¹åºŸäº† ...

## ä¸€å¥è¯æè¿°

`document.domain` å°†å˜ä¸ºå¯è¯»å±æ€§ã€‚

> åˆ«ç€æ€¥ï¼Œé¢„è®¡æœ€æ—©å˜åŒ–æ—¶é—´æ˜¯ `Chrome 101` ç‰ˆæœ¬ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ `97`ã€‚

## å¯¹æˆ‘ä»¬æœ‰å•¥å½±å“ï¼Ÿ

å¦‚æœä½ çš„ä¸šåŠ¡é‡Œæœ‰é€šè¿‡æ›´æ”¹ `document.domain` æ¥è¿›è¡Œè·¨åŸŸçš„åœºæ™¯ï¼Œé©¬ä¸Šå°±èŠ­æ¯”Qäº†ï¼Œå¾—å¿«ç‚¹è¿›è¡Œæ”¹é€ äº†ã€‚

## ç”¨ `document.domain` æ˜¯å’‹è·¨åŸŸçš„ï¼Ÿ

è·¨åŸŸè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ï¼Œå¤§å®¶åº”è¯¥éƒ½æ¸…æ¥šçš„å¾ˆï¼Œå†æ¥å•°å—¦ä¸€éã€‚

ç®€å•çš„è¯´ï¼š

å¦‚æœç½‘é¡µçš„ï¼š `&#x534F;&#x8BAE;&#x3001;&#x57DF;&#x540D;&#x3001;&#x7AEF;&#x53E3;` æœ‰ä¸€ä¸ªä¸ä¸€æ ·ï¼Œå®ƒä»¬çš„èµ„æºæ— æ³•äº’ç›¸è®¿é—®ã€‚

æˆ‘ä»¬é€šè¿‡äº†ä¸€äº›æ‰‹æ®µï¼Œå¯ä»¥ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œè®©éåŒæºçš„èµ„æºä¹Ÿèƒ½äº’ç›¸è®¿é—®ï¼Œè¿™å°±æ˜¯è·¨åŸŸã€‚

é‚£ä¹ˆç”¨ `document.domain` ä¹‹å‰æ˜¯å’‹è·¨åŸŸçš„å‘¢ï¼Ÿ

å‡å¦‚æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š

æˆ‘ä»¬åœ¨ä¸€ä¸ªé¡µé¢ `https://a.conardli.com` åµŒå…¥äº†ä¸€ä¸ª `iframe` é¡µé¢ `https://b.conardli.com`ã€‚å®ƒä»¬çš„äºŒçº§åŸŸåéƒ½æ˜¯ `conardli.com`ã€‚

è¿™æ—¶å€™ï¼Œå› ä¸ºæµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ï¼Œæˆ‘ä»¬ä¸»é¡µé¢å’Œ `iframe` è‚¯å®šæ˜¯æ— æ³•é€šä¿¡çš„ã€‚
![](https://img-blog.csdnimg.cn/img_convert/b97bdf3da1144df58051a4c8baa2c6ce.png)

ä½†æ˜¯ï¼Œå½“ä¸¤ä¸ªé¡µé¢çš„ `document.domain` éƒ½è®¾ç½®ä¸º `conard.com` ä¹Ÿå°±æ˜¯äºŒçº§åŸŸåçš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±å°†ä¸¤ä¸ªæ¥æºè§†ä¸ºåŒæºã€‚

è¿™æ—¶å€™ä¸»é¡µé¢å°±å¯ä»¥å’Œ `iframe` è¿›è¡Œé€šä¿¡äº†ï¼ˆæ¯”å¦‚è®¿é—® `iframe` çš„ `document`ï¼‰ã€‚
![](https://img-blog.csdnimg.cn/img_convert/e12f51ba5fac6b7999bb4383e4334c0f.png)

å¦å¤–ï¼Œè¿˜æœ‰ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬æœ¬åœ°è°ƒè¯•çš„æ—¶å€™å¯èƒ½ç»å¸¸ä¼šç”¨åˆ°ï¼šç›¸åŒåŸŸåã€ä¸åŒç«¯å£é—´çš„è·¨åŸŸã€‚

æ¯”å¦‚ï¼Œä¸Šé¢ä¸¤ä¸ªç½‘é¡µï¼Œåœ¨è¿˜æ²¡ä¸Šçº¿çš„æ—¶å€™ï¼Œå¯èƒ½æˆ‘ä»¬è¿™æ—¶å€™è¦åœ¨æœ¬åœ°è°ƒè¯•åŠŸèƒ½ï¼Œå¯èƒ½æŠŠå®ƒä»¬éƒ¨ç½²åœ¨æœ¬åœ°çš„ä¸åŒç«¯å£ä¸Šï¼š

* `http://localhost:8888/`
* `http://localhost:6666/`

é»˜è®¤æƒ…å†µä¸‹å®ƒä¿©è‚¯å®šä¹Ÿæ˜¯ä¸èƒ½è·¨åŸŸé€šä¿¡çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬çš„ `document.domain` éƒ½è®¾ç½®ä¸º `localhost`ï¼Œå°±å¯ä»¥è·¨è¿‡ç«¯å£ä¸åŒçš„é™åˆ¶äº†ã€‚

## ç”¨çš„å¥½å¥½åœ°ï¼Œä¸ºå•¥è¦ç¦ç”¨æï¼Ÿ

ä¸å®‰å…¨å‘€ã€‚
![](https://img-blog.csdnimg.cn/img_convert/f506448dec985ec02b0a13a0ed620cfb.png)

ä½ è§‰çš„äºŒçº§åŸŸåä¸€æ ·çš„åŸŸåä¸€å®šå±äºåŒä¸€ä¸ªä¸šåŠ¡å—ï¼Ÿ

é‚£å¯ä¸ä¸€å®šï¼Œæ¯”å¦‚ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„é¡µé¢æ‰˜ç®¡æœåŠ¡ï¼Œå®ƒå¯èƒ½åªæœ‰ä¸€ä¸ªäºŒçº§åŸŸå `xxx.com`ã€‚

ä¸åŒçš„ä¸ªäººç”¨æˆ·ä½¿ç”¨å®ƒçš„æœåŠ¡çš„æ—¶å€™å¯ä»¥å®šåˆ¶è‡ªå·±çš„åŸŸåã€‚ `&#x5C0F;&#x660E;.xxx.com`ã€ `&#x5C0F;&#x82B1;.xxx.com`ã€‚

è¿™æ—¶å€™ï¼Œè¿™ç§è·¨åŸŸçš„æ–¹å¼å°±å¯èƒ½è¢«æ»¥ç”¨äº†ã€‚

æ‰€ä»¥ï¼Œ `Chrome` å†³å®šè¦ç¦ç”¨æ‰å®ƒã€‚

## æœ‰å•¥æ›¿ä»£æ–¹æ¡ˆå•Šï¼Ÿ

ä¸æ…Œï¼Œè¿˜æœ‰ `postMessage`ã€‚
![](https://img-blog.csdnimg.cn/img_convert/c7c4e3cb9e272c84683dfc2535829424.png)

å¤§å¤šæ•°åœºæ™¯é‡Œé¢ï¼Œ `postMessage()`æˆ– `Channel Messaging API` éƒ½å¯ä»¥æ›¿ä»£ `document.domain`ã€‚

ä¸»é¡µé¢ï¼š `https://a.conardli.com`

```go
//Â ç»™Â https://b.conardli.comÂ å‘æ¶ˆæ¯
iframe.postMessage('å“ˆå–½',Â 'https://b.conardli.com');

//Â æ¥æ”¶ä¿¡æ¯
iframe.addEventListener('message',Â (event)Â =>Â {
Â Â //Â æŠŠä¸æƒ³è¦çš„ä¿¡æ¯è¿‡æ»¤æ‰
Â Â ifÂ (event.originÂ !==Â 'https://b.conardli.com')Â return;

Â Â ifÂ (event.dataÂ ===Â 'succeeded')Â {
Â Â Â Â //Â å¹²ç‚¹åˆ«çš„Â ...
Â Â }
});
```

`iframe` é¡µé¢ï¼š `https://b.conardli.com`

```go
//Â æ¥æ”¶ä¿¡æ¯
window.addEventListener('message',Â (event)Â =>Â {
Â Â //Â æ‹’ç»æ‰ä¹±ä¸ƒå…«ç³Ÿçš„ä¿¡æ¯
Â Â ifÂ (event.originÂ !==Â 'https://a.conardli.com')Â return;

Â Â //Â æ¢å¤æ¶ˆæ¯
Â Â event.source.postMessage('succeeded',Â event.origin);
});
```

## æˆ‘å°±æƒ³ç”¨ `document.domain` å’‹æ•´ï¼Ÿ

å¯èƒ½ä½ çš„ç½‘ç«™æ”¹é€ èµ·æ¥æœ‰ç‚¹éº»çƒ¦ï¼Œæˆ–è€…ä½ å¯¹ `document.domain` æƒ…æœ‰ç‹¬é’Ÿï¼Ÿ

ç»™ä½ çš„ç½‘é¡µå¢åŠ ä¸‹é¢è¿™ä¸ª `Header` å°±å¯ä»¥äº†ï¼š

```go
Origin-Agent-Cluster:Â ?0
```

ä½†æ˜¯ï¼Œ `Origin-Agent-Cluster` è¿™ä¸ª `Header` çš„ä½œç”¨å¯ä¸æ­¢äºæ­¤ï¼Œæœ‰äº†è§£çš„å°ä¼™ä¼´å¯ä»¥åœ¨è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæ²¡æœ‰çš„è¯æˆ‘å°±æŒ–ä¸ªå‘ä¸‹å›ç»™å¤§å®¶è®²è®²ã€‚

## å‚è€ƒ

* https://developer.chrome.com/blog/immutable-document-domain/

```undefined```

```go
æ¨èé˜…è¯»
```





![](https://img-blog.csdnimg.cn/img_convert/52541f900ad22ffef39e5abf8c395582.png)

_å…³æ³¨å‰ç«¯å¼€å‘åšå®¢ï¼Œæ¯æ—¥åˆ†äº«å¹²è´§ï¼_

å…³æ³¨å‰ç«¯å¼€å‘åšå®¢ï¼Œåœ¨åå°å›å¤ä»¥ä¸‹å…³é”®å­—å¯ä»¥è·å–èµ„æºã€‚

1. å›å¤ã€Œå°æŠ„ã€ï¼Œé¢†å–Vueã€JavaScript å’Œ WebComponent å°æŠ„ PDF
2. å›å¤ã€ŒVueè„‘å›¾ã€è·å– Vue ç›¸å…³è„‘å›¾
3. å›å¤ã€Œæ€ç»´å›¾ã€è·å– JavaScript ç›¸å…³æ€ç»´å›¾
4. å›å¤ã€Œç®€å†ã€è·å–ç®€å†åˆ¶ä½œå»ºè®®
5. å›å¤ã€Œç®€å†æ¨¡æ¿ã€è·å–ç²¾é€‰çš„ç®€å†æ¨¡æ¿
6. å›å¤ã€ŒåŠ ç¾¤ã€è¿›å…¥500äººå‰ç«¯ç²¾è‹±ç¾¤
7. å›å¤ã€Œç”µå­ä¹¦ã€ä¸‹è½½æˆ‘æ•´ç†çš„å¤§é‡å‰ç«¯èµ„æºï¼Œå«é¢è¯•ã€Vueå®æˆ˜é¡¹ç›®ã€CSSå’ŒJavaScriptç”µå­ä¹¦ç­‰ã€‚
8. å›å¤ã€ŒçŸ¥è¯†ç‚¹ã€ä¸‹è½½é«˜æ¸…JavaScriptçŸ¥è¯†ç‚¹å›¾è°±

![](https://img-blog.csdnimg.cn/img_convert/49e4e9d19e9671dbbe7be4bf1d83c8c0.png)

**ğŸ‘ğŸ» ç‚¹èµ + åœ¨çœ‹ æ”¯æŒå°ç¼–**
