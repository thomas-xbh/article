---
link: null
title: ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ä½¿ç”¨dumi2æ­å»ºä½ çš„ç»„ä»¶åº“å’Œå‡½æ•°åº“
description: ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ä½¿ç”¨dumi2æ­å»ºä½ çš„ç»„ä»¶åº“å’Œå‡½æ•°åº“
keywords: ä¸ªäººåšå®¢ï¼Œç®€çº¦åšå®¢ï¼Œéƒ­ç‚¯éŸ¦ä¸ªäººåšå®¢ï¼Œéƒ­ç‚¯éŸ¦,éƒ­ç‚¯éŸ¦
author: éƒ­ç‚¯éŸ¦
date: null
publisher: éƒ­ç‚¯éŸ¦ä¸ªäººåšå®¢
stats: paragraph=230 sentences=207, words=1696
---
## ç›®å½•

1. dumiç®€ä»‹
2. åˆ›å»ºdumié¡¹ç›®
3. å¼€å‘åŸºç¡€ç»„ä»¶
4. åŸºäºantdäºŒæ¬¡å¼€å‘
5. å¼€å‘å·¥å…·å‡½æ•°
6. jestå•å…ƒæµ‹è¯•ä¼˜åŒ–
7. æ‰“åŒ…éƒ¨ç½²

**å…¨æ–‡æ¦‚è§ˆ**

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10366cd3709f4feb99b6d5358c1a82fb~tplv-k3u1fbpfcp-watermark.image?)

æœ¬æ–‡ä½¿ç”¨dumi2è¯¦ç»†çš„ä¸€æ­¥ä¸€æ­¥å¸¦ä½ æ­å»ºç»„ä»¶åº“å’Œå‡½æ•°åº“ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œéƒ¨ç½²æ–‡æ¡£ç«™ç‚¹å’Œå‘å¸ƒnpmåŒ…ï¼Œä»¥åŠæ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚

## ä¸€. dumiç®€ä»‹

ç›´æ¥å¼•ç”¨[å®˜ç½‘](https://d.umijs.org/)çš„ä»‹ç»

### 1.1 ä»€ä¹ˆæ˜¯ dumi

dumiï¼Œä¸­æ–‡å‘éŸ³ **å˜Ÿç±³**ï¼Œæ˜¯ä¸€æ¬¾ä¸ºç»„ä»¶å¼€å‘åœºæ™¯è€Œç”Ÿçš„é™æ€ç«™ç‚¹æ¡†æ¶ï¼Œä¸ [father](https://github.com/umijs/father) ä¸€èµ·ä¸ºå¼€å‘è€…æä¾›ä¸€ç«™å¼çš„ç»„ä»¶å¼€å‘ä½“éªŒï¼Œ **father è´Ÿè´£ç»„ä»¶æºç æ„å»ºï¼Œè€Œ dumi è´Ÿè´£ç»„ä»¶å¼€å‘åŠç»„ä»¶æ–‡æ¡£ç”Ÿæˆ**ã€‚

ç®€å•æ¥è¯´ **dumi**æ˜¯ä¸€ä¸ªå¼€å‘ç»„ä»¶åº“å’Œå‡½æ•°åº“çš„æ¡†æ¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„å¼€å‘ç»„ä»¶å’Œç¤ºä¾‹æ–‡æ¡£ï¼Œæœ€ç»ˆæŠŠ **ç¤ºä¾‹æ–‡æ¡£**æ‰“åŒ…ä¸ºé™æ€ç«™ç‚¹éƒ¨ç½²ï¼Œå¹¶ä¸”æŠŠç»„ä»¶æºç æ‰“åŒ…ä¸ºæœ€ç»ˆå‘å¸ƒçš„ **npmåŒ…**ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºç»„ä»¶å¼€å‘ï¼ŒèŠ‚çœäº†å¤§é‡é…ç½®çš„æ—¶é—´ã€‚

### 1.2 ç‰¹æ€§

å…¨æ–°çš„ dumi 2.0 ä¸»è¦å…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š

* ğŸš€ **æ›´å¥½çš„ç¼–è¯‘æ€§èƒ½**ï¼šé€šè¿‡ç»“åˆä½¿ç”¨[Umi 4 MFSU](https://umijs.org/blog/mfsu-faster-than-vite)ã€esbuildã€SWCã€æŒä¹…ç¼“å­˜ç­‰æ–¹æ¡ˆï¼Œå¸¦æ¥æ¯” dumi 1.x æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦
* ğŸ” **å†…ç½®å…¨æ–‡æœç´¢**ï¼šä¸éœ€è¦æ¥å…¥ä»»ä½•ä¸‰æ–¹æœåŠ¡ï¼Œæ ‡é¢˜ã€æ­£æ–‡ã€demo ç­‰å†…å®¹å‡å¯è¢«æœç´¢ï¼Œæ”¯æŒå¤šå…³é”®è¯æœç´¢ï¼Œä¸”ä¸ä¼šå¸¦æ¥äº§ç‰©ä½“ç§¯çš„å¢åŠ 
* ğŸ¨ **å…¨æ–°ä¸»é¢˜ç³»ç»Ÿ**ï¼šä¸ºä¸»é¢˜åŒ…å¢åŠ æ’ä»¶ã€å›½é™…åŒ–ç­‰èƒ½åŠ›çš„æ”¯æŒï¼Œä¸”å‚è€ƒ[Docusaurus](https://docusaurus.io/docs/swizzling) ä¸ºä¸»é¢˜ç”¨æˆ·æä¾›å±€éƒ¨è¦†ç›–èƒ½åŠ›ï¼Œæ›´å¼ºæ›´æ˜“ç”¨
* ğŸš¥ **çº¦å®šå¼è·¯ç”±å¢å¼º**ï¼šé€šè¿‡æ‹†åˆ†è·¯ç”±æ¦‚å¿µã€ç®€åŒ–è·¯ç”±é…ç½®ç­‰æ–¹å¼ï¼Œè®©è·¯ç”±ç”Ÿæˆä¸€æ”¹ dumi 1.x çš„æ€ªå¼‚ã€ç¹çï¼Œæ›´åŠ ç¬¦åˆç›´è§‰
* ğŸ’¡ **èµ„äº§å…ƒæ•°æ® 2.0**ï¼šåœ¨ 1.x åŠ JSON Schema çš„åŸºç¡€ä¸Šå¯¹èµ„äº§å±æ€§å®šä¹‰ç»“æ„è¿›è¡Œå…¨æ–°è®¾è®¡ï¼Œä¸ºèµ„äº§çš„æµé€šæä¾›æ›´å¤šå¯èƒ½
* ğŸ’ **ç»§ç»­ä¸ºç»„ä»¶ç ”å‘è€Œç”Ÿ**ï¼šæä¾›ä¸å…¨æ–°çš„ NPM åŒ…ç ”å‘å·¥å…·[father 4](https://github.com/umijs/father) é›†æˆçš„è„šæ‰‹æ¶ï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€ç«™å¼çš„ç ”å‘ä½“éªŒ

### 1.3 ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°

æ­å»ºè‡ªå·±çš„å‡½æ•°åº“å’Œç»„ä»¶åº“é€šå¸¸æ˜¯ä¸ºäº†æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¼€å‘æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ï¼š

1. å¤šä¸ªé¡¹ç›®å…±ç”¨çš„å‡½æ•°æˆ–ç»„ä»¶ã€‚å¦‚æœä½ æœ‰å¤šä¸ªé¡¹ç›®éœ€è¦ä½¿ç”¨åŒæ ·çš„å‡½æ•°æˆ–ç»„ä»¶ï¼Œå¯ä»¥å°†å…¶å°è£…æˆåº“æ¥æé«˜å¤ç”¨æ€§å’Œå¼€å‘æ•ˆç‡ã€‚è¿™æ ·åšå¯ä»¥é¿å…é‡å¤ç¼–å†™ä»£ç ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿åç»­ç»´æŠ¤å’Œæ›´æ–°ã€‚
2. å›¢é˜Ÿåä½œå¼€å‘ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªå›¢é˜Ÿä¸­è¿›è¡Œåä½œå¼€å‘ï¼Œæ­å»ºè‡ªå·±çš„å‡½æ•°åº“å’Œç»„ä»¶åº“å¯ä»¥æ–¹ä¾¿ä¸åŒæˆå‘˜ä¹‹é—´çš„ä»£ç å…±äº«å’Œåä½œã€‚è¿™æ ·åšå¯ä»¥é¿å…ä¸åŒæˆå‘˜ä¹‹é—´é‡å¤ç¼–å†™ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚
3. æé«˜ä»£ç å¯ç»´æŠ¤æ€§ã€‚æ­å»ºè‡ªå·±çš„å‡½æ•°åº“å’Œç»„ä»¶åº“å¯ä»¥æ–¹ä¾¿åç»­çš„ä»£ç ç»´æŠ¤å’Œæ›´æ–°ã€‚è¿™æ ·åšå¯ä»¥é¿å…ä»£ç ä¸­å­˜åœ¨å¤§é‡çš„å†—ä½™ä»£ç å’Œé‡å¤ä»£ç ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## äºŒ. å®‰è£…dumi

### 2.1 ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ­£ç¡®å®‰è£… [Node.js](https://nodejs.org/en/) ä¸”ç‰ˆæœ¬ä¸º 14+ å³å¯ã€‚

```
$ <span class="hljs-keyword">node</span> <span class="hljs-title">-v</span>
v14.<span class="hljs-number">19.1</span>
```

### 2.2 åˆ›å»ºé¡¹ç›®

å…ˆæ‰¾ä¸ªåœ°æ–¹å»ºä¸ªç©ºç›®å½•

```
<span class="hljs-built_in">mkdir</span> dumi2-<span class="hljs-built_in">demo</span> && cd dumi2-<span class="hljs-built_in">demo</span>
```

ç›®å½•åˆ›å»ºå¥½åé€šè¿‡å®˜æ–¹å·¥å…·åˆ›å»ºé¡¹ç›®ï¼Œé€‰æ‹©ä½ éœ€è¦çš„æ¨¡æ¿

```
<span class="hljs-attribute">npx create-dumi</span>
```

dumi2ç›®å‰æ¨¡ç‰ˆæœ‰ä¸‰ç§

* Static Siteï¼šé™æ€æ–‡æ¡£ç«™ç‚¹
* React Library: reactç»„ä»¶åº“
* Theme Package: ä¸»é¢˜åŒ…

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48a3fd2d46c547dfb557d7128e8ad79b~tplv-k3u1fbpfcp-watermark.image?)

åœ¨è¿›è¡Œæ¨¡ç‰ˆç±»å‹çš„æ—¶å€™æˆ‘ä»¬é€‰æ‹© **React Library**æ¨¡ç‰ˆï¼Œå¯ä»¥å¼€å‘ç»„ä»¶å’Œç”Ÿæˆé™æ€ç«™ç‚¹æ–‡æ¡£ï¼Œå…¶ä»–çš„æ˜¯é€‰æ‹©npmç®¡ç†å·¥å…·ï¼ŒåŒ…åç§°ï¼Œæè¿°å’Œé‚®ç®±ï¼ŒæŒ‰è‡ªå·±æƒ…å†µæ¥è¾“å…¥å°±å¥½äº†ï¼Œè¿™é‡ŒåŒ…åç§°è¾“å…¥çš„æ˜¯ **dumi2-demo**ã€‚

ç­‰å¾…å®‰è£…å®Œä¾èµ–åå¯åŠ¨é¡¹ç›®ï¼š

```
<span class="hljs-built_in">npm</span> start
```

é¡¹ç›®å°±å¯åŠ¨èµ·æ¥äº†ï¼Œè¾“å…¥[http://localhost:8000](http://localhost:8000)ï¼Œå¯ä»¥çœ‹åˆ°å¯åŠ¨æˆåŠŸåçš„é¡µé¢ï¼Œè¿™ä¸ªç•Œé¢ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰“åŒ…åçš„é™æ€ç«™ç‚¹ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09c71105e6904a699b943361c9179a7e~tplv-k3u1fbpfcp-watermark.image?)

### 2.3 ç›®å½•ç»“æ„

ä¸€ä¸ªæ™®é€šçš„ã€ä½¿ç”¨ dumi åšç ”å‘çš„ç»„ä»¶åº“ç›®å½•ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š

```
.
&#x251C;&#x2500;&#x2500; docs
&#x2502;   &#x251C;&#x2500;&#x2500; <span class="hljs-keyword">index</span>.md
&#x2502;   &#x251C;&#x2500;&#x2500; guide
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; <span class="hljs-keyword">index</span>.md
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; help.md
&#x251C;&#x2500;&#x2500; src
&#x2502;   &#x251C;&#x2500;&#x2500; Button
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; <span class="hljs-keyword">index</span>.tsx
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; <span class="hljs-keyword">index</span>.less
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; <span class="hljs-keyword">index</span>.md
&#x2502;   &#x2514;&#x2500;&#x2500; <span class="hljs-keyword">index</span>.ts
&#x251C;&#x2500;&#x2500; .dumirc.ts
&#x2514;&#x2500;&#x2500; .fatherrc.ts
```

### 2.4 å®Œå–„å·¥ä½œ

åœ¨è¿è¡ŒæˆåŠŸåçš„é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å·¦ä¸Šè§’é¡¹ç›®åç§°æ¢è¡Œï¼Œä¸€ä¸ªæ˜¯è¦æŠŠFooä¿®æ”¹ä¸ºç»„ä»¶åº“é€‰é¡¹ã€‚

ä¿®æ”¹é¡¹ç›®åç§°é¡¹ç›®åç§°æ¢è¡Œé—®é¢˜å¯ä»¥æ ¹æ®ç±»åè¦†ç›–åŸæœ‰æ ·å¼ï¼Œåœ¨.dumirc.tsæ–‡ä»¶ä¸­æ·»åŠ æ³¨å…¥çš„cssé…ç½®:

```
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'dumi'</span>;
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({

  <span class="hljs-attr">styles</span>: [
    <span class="hljs-string">`.dumi-default-header-left {
       width: 220px !important;
    }`</span>,
  ],
});
```

ä¿®æ”¹Fooé€‰é¡¹ä¸ºç»„ä»¶åº“ï¼Œåœ¨.dumirc.tsæ–‡ä»¶ä¸­æ·»åŠ é…ç½®:

```
<span class="hljs-keyword">import</span> { defineConfig } from <span class="hljs-string">'dumi'</span>;
&#x200B;
export <span class="hljs-keyword">default</span> defineConfig({

<span class="hljs-symbol">  themeConfig:</span> {
<span class="hljs-symbol">    name:</span> <span class="hljs-string">'dumi2-demo'</span>,
<span class="hljs-symbol">    nav:</span> [
      { <span class="hljs-string">title:</span> <span class="hljs-string">'&#x4ECB;&#x7ECD;'</span>, <span class="hljs-string">link:</span> <span class="hljs-string">'/guide'</span> },
      { <span class="hljs-string">title:</span> <span class="hljs-string">'&#x7EC4;&#x4EF6;'</span>, <span class="hljs-string">link:</span> <span class="hljs-string">'/components/Foo'</span> },
    ],
  },

});
```

è°ƒæ•´åçš„ç•Œé¢å°±å˜æˆäº†ï¼Œæ­¤æ—¶å°±å¯ä»¥å¼€å§‹ç»„ä»¶å’Œå‡½æ•°çš„å¼€å‘äº†ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43ca55d8ece64b78ad4b224709a39081~tplv-k3u1fbpfcp-watermark.image?)

## ä¸‰. å¼€å‘åŸºç¡€ç»„ä»¶

> macç”µè„‘å¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„å‘½ä»¤è¡Œæ“ä½œï¼Œwindowç³»ç»Ÿå»ºè®®ä½¿ç”¨gitå‘½ä»¤è¡Œæ“ä½œã€‚

### 3.1 **æ·»åŠ ç»„ä»¶æºä»£ç **

è¿™é‡Œå…ˆæ–°å¢ä¸€ä¸ªç®€å•çš„Buttonç»„ä»¶ï¼Œåœ¨srcä¸‹é¢æ–°å¢Buttonæ–‡ä»¶å†…å†™å…¥index.tsxæ–‡ä»¶ã€‚

```
<span class="hljs-keyword">mkdir</span> src/<span class="hljs-keyword">Button</span> && touch src/<span class="hljs-keyword">Button</span>/index.tsx
```

åœ¨æ–‡ä»¶ä¸­æ–°å¢ä¸€ä¸ªç®€å•çš„Buttonç»„ä»¶ä»£ç ï¼š

```
<span class="hljs-keyword">import</span> React, { memo } from <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/index.less'</span>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ButtonProps</span> </span>{

  type?: <span class="hljs-string">'primary'</span> | <span class="hljs-string">'default'</span>;

  children?: React.ReactNode;
  onClick?: React.MouseEventHandler<htmlbuttonelement>
}
&#x200B;

<span class="hljs-keyword">const</span> Button: React.FC<buttonprops> = (props) => {
  <span class="hljs-keyword">const</span> { type = <span class="hljs-string">'default'</span>, children, onClick } = props
  <span class="hljs-keyword">return</span> (
    <button type="<span" class="hljs-string">'button'
      className={`dumi-btn ${type ? <span class="hljs-string">'dumi-btn-'</span> + type : <span class="hljs-string">''</span>}`}
      onClick={onClick}
    >
      {children}
    </button>
  );
};
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> memo(Button);
</buttonprops></htmlbuttonelement>
```

### 3.2 **æ·»åŠ lessæ ·å¼å’Œå˜é‡**

å…ˆå®šä¹‰lessæ ·å¼å˜é‡ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ—¶å€™æ”¹å˜ç»„ä»¶ä¸»é¢˜æ ·å¼ã€‚

åœ¨srcä¸‹åˆ›å»ºvariables.lessæ–‡ä»¶

```
touch src/variables.<span class="hljs-keyword">less</span>
```

æ·»åŠ ä¸»é¢˜ä»£ç ï¼š

```

<span class="hljs-variable">@dumi-primary:</span> <span class="hljs-number">#4d90fe</span>;
```

ç„¶ååœ¨Buttonç»„ä»¶åº“ä¸‹é¢æ–°å»ºstylesæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ–°å»ºindex.lessæ–‡ä»¶

```
<span class="hljs-keyword">mkdir</span> src/<span class="hljs-keyword">Button</span>/styles && touch src/<span class="hljs-keyword">Button</span>/styles/index.less
```

æ·»åŠ æ ·å¼æ–‡ä»¶

```

<span class="hljs-keyword">@import</span> <span class="hljs-string">'../../variables.less'</span>;
&#x200B;
<span class="hljs-selector-class">.dumi-btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">transition</span>: all .<span class="hljs-number">3s</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}
&#x200B;
<span class="hljs-selector-class">.dumi-btn-default</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#d9d9d9</span>;
&#x200B;
  <span class="hljs-selector-tag">&</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-variable">@dumi-primary</span>;
    <span class="hljs-attribute">border-color</span>: <span class="hljs-variable">@dumi-primary</span>;
  }
}
&#x200B;
<span class="hljs-selector-class">.dumi-btn-primary</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-variable">@dumi-primary</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-variable">@dumi-primary</span>;
}
```

ç»„ä»¶æºä»£ç æ·»åŠ å¥½åï¼Œéœ€è¦åœ¨src/index.tsä¸­å¼•å…¥åæš´éœ²ä¸€ä¸‹ï¼š

```

<span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> Button } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button'</span>;
```

åœ¨è¿™é‡Œå¼•å…¥å¹¶æš´éœ²å‡ºå»ä»¥åï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®ä¸­é€šè¿‡ `import { Button } from 'dumi2-demo';`æ¥å¼•å…¥äº†ã€‚

### 3.3 **æ·»åŠ demoç¤ºä¾‹**

æ¯ä¸€ä¸ªç»„ä»¶æˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªdemoç¤ºä¾‹ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…èƒ½æ›´æ–¹ä¾¿çš„ä½¿ç”¨ã€‚

åœ¨Buttonç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªdemoæ–‡ä»¶å¤¹ï¼Œå†…å»ºä¸€ä¸ªåŸºç¡€æ¼”ç¤ºbase.tsxæ–‡ä»¶:

```
<span class="hljs-keyword">mkdir</span> src/<span class="hljs-keyword">Button</span>/demo && touch src/<span class="hljs-keyword">Button</span>/demo/base.tsx
```

ç„¶åæ·»åŠ ç»„ä»¶çš„æ¼”ç¤ºä»£ç ï¼š

```

&#x200B;
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { Button } <span class="hljs-keyword">from</span> <span class="hljs-string">'dumi2-demo'</span>;
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () => {
&#x200B;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag"><></span>
      <span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"default"</span>></span>&#x9ED8;&#x8BA4;&#x6309;&#x94AE;<span class="hljs-tag">Button</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>></span>&#x4E3B;&#x8981;&#x6309;&#x94AE;<span class="hljs-tag">Button</span>>
    <span class="hljs-tag"></></span>
  );
}
```

### 3.4 **æ·»åŠ ç»„ä»¶æ–‡æ¡£**

å†åœ¨è¯¥æ–‡ä»¶åŒç›®å½•æ–°å»ºä¸€ä¸ªindex.mdæ–‡ä»¶ä½œä¸ºæ–‡æ¡£è¯´æ˜ï¼Œè¿™ä¹Ÿæ˜¯ç”Ÿæˆé™æ€æ–‡æ¡£ç«™ç‚¹æ‰€éœ€è¦çš„ã€‚

```
<span class="hljs-keyword">touch</span> src/Button/<span class="hljs-built_in">index</span>.md
```

æ·»åŠ æ–‡æ¡£å†…å®¹ï¼Œå…·ä½“å†…å®¹æè¿°å¯ä»¥çœ‹å®˜ç½‘[MakeDowné…ç½®é¡¹](https://d.umijs.org/config/markdown)ï¼Œè¿™é‡Œåªåœ¨æ³¨é‡Šé‡Œé¢è®²ä¸€ä¸‹ç”¨åˆ°çš„é…ç½®ã€‚

```

<span class="hljs-attr">category:</span> <span class="hljs-string">Components</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">Button</span> <span class="hljs-string">&#x6309;&#x94AE;</span>
<span class="hljs-attr">toc:</span> <span class="hljs-string">content</span>
<span class="hljs-attr">group:</span>
  <span class="hljs-attr">title:</span> <span class="hljs-string">&#x57FA;&#x7840;&#x7EC4;&#x4EF6;</span>
  <span class="hljs-attr">order:</span> <span class="hljs-number">1</span>

<span class="hljs-string">&#x200B;</span>

<span class="hljs-string">&#x200B;</span>

<span class="hljs-string">&#x200B;</span>
<span class="hljs-string">&#x57FA;&#x7840;&#x7684;&#x6309;&#x94AE;&#x7EC4;&#x4EF6;</span> <span class="hljs-string">Button&#x3002;</span>
<span class="hljs-string">&#x200B;</span>

<span class="hljs-string">&#x200B;</span>

<span class="hljs-string"><code< span> <span class="hljs-string">src="./demo/base.tsx">&#x57FA;&#x7840;&#x7528;&#x6CD5;</span></code<></span>
```

â€‹

â€‹

| å±æ€§ | ç±»å‹                   | é»˜è®¤å€¼   | å¿…å¡« | è¯´æ˜ |
| ---- | ---------------------- | -------- | ---- | ---- |
| type | 'primary' | 'default' | 'default |  false  | æŒ‰é’®ç±»å‹ |

å…¨éƒ¨é…ç½®å¥½åï¼Œéœ€è¦é‡å¯ä¸€ä¸‹dumi2é¡¹ç›®ï¼Œé‡å¯åå°±å¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ°æ•ˆæœäº†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c054950d954412b9bc9d31c263eb57b~tplv-k3u1fbpfcp-watermark.image?)

### 3.5 æ·»åŠ å•å…ƒæµ‹è¯•

**å‡†å¤‡å·¥ä½œ**

æ·»åŠ å¥½åŸºç¡€ç»„ä»¶åï¼Œé€šå¸¸éœ€è¦åŠ ä¸Šç»™ç»„ä»¶æ·»åŠ æµ‹è¯•ä»£ç ï¼Œæ¥ä¿éšœç»„ä»¶çš„å¥å£®æ€§ã€‚

æµ‹è¯•æ¡†æ¶é‡‡ç”¨reactæœ€å¸¸ç”¨çš„jestå·¥å…·ï¼Œå†é…åˆreacté…å¥—çš„å•å…ƒæµ‹è¯•åº“ï¼Œå®‰è£…ä¾èµ–ï¼š

```
npm i jest <span class="hljs-symbol">@testing</span>-library/react <span class="hljs-symbol">@types</span>/jest ts-jest jest-environment-jsdom jest-less-loader typescript<span class="hljs-symbol">@4</span> -D
```

* Jest: jestå•å…ƒæµ‹è¯•æ ¸å¿ƒåº“
* @testing-library/reactï¼šReactçš„æµ‹è¯•å·¥å…·åº“ï¼Œåœ¨Reactåº”ç”¨ä¸­è¿›è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚
* @types/jestï¼šjestçš„ç±»å‹ã€‚
* ts-jestï¼šè®©jestæ”¯æŒtsè¯­æ³•çš„é¢„è®¾ã€‚
* jest-environment-jsdom: jestçš„æµ‹è¯•ç¯å¢ƒï¼Œä½¿ç”¨js-domåº“æ¨¡æ‹Ÿdomç¯å¢ƒï¼Œé»˜è®¤æ˜¯nodeç¯å¢ƒã€‚
* jest-less-loader: jestä¸è®¤è¯†lesså’Œcssï¼Œä½¿ç”¨è¯¥æ’ä»¶ä½¿jestæ”¯æŒlesså’Œcssã€‚
* tytpescript: è¿™æ˜¯å®‰è£…äº†4ç‰ˆæœ¬ï¼Œæœ€æ–°çš„5ç‰ˆæœ¬ä¼šæœ‰è­¦å‘Šã€‚

è£…å¥½ä¾èµ–ååœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºjestçš„é…ç½®æ–‡ä»¶jest.config.js

```
<span class="hljs-selector-tag">touch</span> <span class="hljs-selector-tag">jest</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span>
```

åœ¨jest.config.jsæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```

<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  preset: <span class="hljs-string">'ts-jest'</span>,
  testEnvironment: <span class="hljs-string">'jsdom'</span>,
  roots: [<span class="hljs-string">'./src'</span>],
  collectCoverage: <span class="hljs-keyword">true</span>,
  coverageDirectory: <span class="hljs-string">'coverage'</span>,
  transform: {
    <span class="hljs-string">'\.(less|css)$'</span>: <span class="hljs-string">'jest-less-loader'</span>
  },

  collectCoverageFrom: [<span class="hljs-string">'src/**/*.tsx'</span>, <span class="hljs-string">'src/**/*.ts'</span>, <span class="hljs-string">'!src/index.ts'</span>, <span class="hljs-string">'!src/**/demo/*'</span>],
};
```

**ç¼–å†™å•å…ƒæµ‹è¯•**

åœ¨Buttonç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `__tests__`æ–‡ä»¶å¤¹æ”¾ç½®å•å…ƒæµ‹è¯•ä»£ç ï¼Œåœ¨é‡Œé¢æ–°å»ºindex.test.tsxã€‚

```
<span class="hljs-keyword">mkdir</span> src/<span class="hljs-keyword">Button</span>/__tests__ && touch src/<span class="hljs-keyword">Button</span>/__tests__/index.test.tsx
```

åœ¨index.test.tsxæ–‡ä»¶ä¸­ç¼–å†™æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä»£ç 

```

&#x200B;
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { render, fireEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@testing-library/react'</span>;
<span class="hljs-keyword">import</span> Button <span class="hljs-keyword">from</span> <span class="hljs-string">'..'</span>;
&#x200B;
describe(<span class="hljs-string">'Button&#x7EC4;&#x4EF6;'</span>, () => {
  it(<span class="hljs-string">'&#x80FD;&#x591F;&#x6B63;&#x786E;&#x6E32;&#x67D3;&#x6309;&#x94AE;&#x6587;&#x5B57;'</span>, () => {
    <span class="hljs-keyword">const</span> buttonText = <span class="hljs-string">'&#x6309;&#x94AE;&#x6587;&#x5B57;'</span>;
    <span class="hljs-keyword">const</span> { getByRole } = render(<span class="xml"><span class="hljs-tag"><<span class="hljs-name">Button</span>></span>{buttonText}<span class="hljs-tag">Button</span>></span>);
    <span class="hljs-keyword">const</span> buttonElement = getByRole(<span class="hljs-string">'button'</span>);
    expect(buttonElement.innerHTML).toBe(buttonText);
  });
&#x200B;
  it(<span class="hljs-string">'&#x80FD;&#x591F;&#x6B63;&#x786E;&#x6E32;&#x67D3;&#x9ED8;&#x8BA4;&#x6837;&#x5F0F;&#x7684;&#x6309;&#x94AE;'</span>, () => {
    <span class="hljs-keyword">const</span> { getByRole } = render(<span class="xml"><span class="hljs-tag"><<span class="hljs-name">Button</span> ></span>&#x9ED8;&#x8BA4;&#x6309;&#x94AE;<span class="hljs-tag">Button</span>></span>);
    <span class="hljs-keyword">const</span> buttonElement = getByRole(<span class="hljs-string">'button'</span>);
    expect(buttonElement.classList.contains(<span class="hljs-string">'dumi-btn'</span>)).toBe(<span class="hljs-literal">true</span>);
  });
&#x200B;
  it(<span class="hljs-string">'&#x80FD;&#x591F;&#x6B63;&#x786E;&#x6E32;&#x67D3;&#x4E3B;&#x8981;&#x6837;&#x5F0F;&#x7684;&#x6309;&#x94AE;'</span>, () => {
    <span class="hljs-keyword">const</span> { getByRole } = render(<span class="xml"><span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>></span>&#x4E3B;&#x8981;&#x6309;&#x94AE;<span class="hljs-tag">Button</span>></span>);
    <span class="hljs-keyword">const</span> buttonElement = getByRole(<span class="hljs-string">'button'</span>);
    expect(buttonElement.classList.contains(<span class="hljs-string">'dumi-btn-primary'</span>)).toBe(<span class="hljs-literal">true</span>);
  });
&#x200B;
  it(<span class="hljs-string">'&#x80FD;&#x591F;&#x89E6;&#x53D1;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;'</span>, () => {
    <span class="hljs-keyword">const</span> handleClick = jest.fn();
    <span class="hljs-keyword">const</span> { getByRole } = render(<span class="xml"><span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>></span>&#x70B9;&#x51FB;&#x6309;&#x94AE;<span class="hljs-tag">Button</span>></span>);
    <span class="hljs-keyword">const</span> buttonElement = getByRole(<span class="hljs-string">'button'</span>);
    fireEvent.click(buttonElement);

    expect(handleClick).toHaveBeenCalledTimes(<span class="hljs-number">1</span>);
  });
});
```

å•å…ƒæµ‹è¯•ä»£ç åˆ†åˆ«æµ‹è¯•äº†æŒ‰é’®åŸºç¡€æ¸²æŸ“ï¼Œæ¸²æŸ“é»˜è®¤æ ·å¼ï¼Œæ¸²æŸ“ä¸»è¦æ ·å¼ä»¥åŠç‚¹å‡»æµ‹è¯•åŠŸèƒ½ã€‚

ä¿å­˜ååœ¨å‘½ä»¤è¡Œæ‰§è¡Œnpx jestæ‰§è¡Œä¸€ä¸‹å•å…ƒæµ‹è¯•:

```
<span class="hljs-attribute">npx jest</span>
```

> jestä¼šè‡ªåŠ¨å¯»æ‰¾ç›®å½•ä¸­ `__tests__`æ–‡ä»¶å¤¹ï¼Œå»æ‰§è¡Œå†…éƒ¨ä»¥.test.{js, jsx, ts, tsx}ç»“å°¾çš„æ–‡ä»¶ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6fb62832cbdf49f584513268ce096da3~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†Buttonç»„ä»¶çš„å•å…ƒæµ‹è¯•ï¼Œå¹¶ä¸”æœ€åç”Ÿæˆäº†æµ‹è¯•æŠ¥å‘Šï¼Œæ ‡æ³¨äº†æµ‹è¯•äº†å“ªäº›æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„è¦†ç›–ç‡ï¼Œæµ‹è¯•æƒ…å†µã€‚

å¹¶ä¸”ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šçš„é™æ€ç«™ç‚¹ **coverage**æ–‡ä»¶å¤¹ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€coverage/lcov-report/index.htmlæ–‡ä»¶ï¼Œå³å¯çœ‹åˆ°æµ‹è¯•æŠ¥å‘Šï¼Œé€šè¿‡å¯¹æ¯ä¸ªæ–‡ä»¶çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°æœ‰å“ªäº›å•å…ƒæµ‹è¯•æ²¡è¦†ç›–åˆ°çš„åœ°æ–¹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å†™å•å…ƒæµ‹è¯•ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e4394d3a0bf463e90d5d978c09c64ea~tplv-k3u1fbpfcp-watermark.image?)

## å››. åŸºäºantdäºŒæ¬¡å¼€å‘

æœ‰æ—¶å€™é™¤äº†ä»0å°è£…åŸºç¡€ç»„ä»¶ä¹‹å¤–ï¼Œè¿˜ä¼šåŸºäºantdç­‰ç»„ä»¶åº“è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œæ–¹å¼å’Œå¼€å‘åŸºç¡€ç»„ä»¶æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¦åœ¨æ‰“åŒ…packageåŒ…æ—¶æ³¨æ„cssçš„å¼•å…¥ã€‚

### 4.1 æ·»åŠ ç»„ä»¶ä»£ç 

å…ˆå®‰è£…antdåº“ï¼Œå®‰è£…åˆ°å¼€å‘ä¾èµ–ï¼Œåé¢ä¼šæ·»åŠ åˆ°peerDependenciesä¾èµ–ä¸­ã€‚

```
<span class="hljs-built_in">npm</span> i antd -D
```

å…ˆåšä¸€ä¸ªåŸºç¡€çš„ä¾‹å­ï¼ŒäºŒæ¬¡å°è£…ä¸€ä¸‹antdçš„æŒ‰é’®ç»„ä»¶, è®©å®ƒæ˜¯primaryé£æ ¼çš„ç»„ä»¶ã€‚

åœ¨srcä¸‹æ–°å»ºä¸€ä¸ªPrimaryButtonæ–‡ä»¶å¤¹ï¼Œå†…å»ºindex.tsx

```
mkdir src/PrimaryButton && <span class="hljs-keyword">touch</span> src/PrimaryButton/<span class="hljs-built_in">index</span>.tsx
```

åœ¨index.tsxé‡Œé¢ç¼–å†™ä»£ç ï¼š

```

&#x200B;
<span class="hljs-keyword">import</span> React, { memo } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { Button, ButtonProps } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;
&#x200B;
type IPrimaryButtonProps = Omit<buttonprops, <span class="hljs-string">'type'>
&#x200B;
<span class="hljs-keyword">const</span> PrimaryButton: React.FC<iprimarybuttonprops> = <span class="hljs-function">(<span class="hljs-params">props</span>) =></span> {
&#x200B;
  <span class="hljs-keyword">const</span> { children, ...rest } = props
&#x200B;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">Button</span> {<span class="hljs-attr">...rest</span>} <span class="hljs-attr">type</span>=<span class="hljs-string">'primary'</span>></span>
      {children}
    <span class="hljs-tag">Button</span>></span>
  );
};
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> memo(PrimaryButton);
</iprimarybuttonprops></buttonprops,>
```

ç»„ä»¶æºä»£ç æ·»åŠ å¥½åï¼Œéœ€è¦åœ¨src/index.tsä¸­å¼•å…¥åæš´éœ²ä¸€ä¸‹ï¼š

```

<span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> PrimaryButton } <span class="hljs-keyword">from</span> <span class="hljs-string">'./PrimaryButton'</span>;
```

åœ¨è¿™é‡Œå¼•å…¥å¹¶æš´éœ²å‡ºå»ä»¥åï¼Œdumiä¼šå¸®æˆ‘é—¨æ”¾åœ¨åŒ…åç§°dumi2-demoé‡Œé¢ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®ä¸­é€šè¿‡

`import { PrimaryButton } from 'dumi2-demo';`æ¥å¼•å…¥äº†ã€‚

### 4.2 **æ·»åŠ demoç¤ºä¾‹**

åœ¨PrimaryButtonç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªdemoæ–‡ä»¶å¤¹ï¼Œå†…å»ºä¸€ä¸ªåŸºç¡€æ¼”ç¤ºbase.tsxæ–‡ä»¶ã€‚

```
<span class="hljs-built_in">mkdir</span> src/PrimaryButton/<span class="hljs-built_in">demo</span> && touch src/PrimaryButton/<span class="hljs-built_in">demo</span>/base.tsx
```

æ·»åŠ ç»„ä»¶ç¤ºä¾‹ä»£ç ï¼š

```

&#x200B;
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { PrimaryButton } <span class="hljs-keyword">from</span> <span class="hljs-string">'dumi2-demo'</span>;
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () => {
&#x200B;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">PrimaryButton</span>></span>&#x9ED8;&#x8BA4;&#x6309;&#x94AE;<span class="hljs-tag">PrimaryButton</span>></span>
  );
}
```

### 4.3 æ·»åŠ ç»„ä»¶æ–‡æ¡£

å†åœ¨è¯¥æ–‡ä»¶åŒç›®å½•æ–°å»ºä¸€ä¸ªindex.mdæ–‡ä»¶ä½œä¸ºæ–‡æ¡£è¯´æ˜ï¼Œè¿™ä¹Ÿæ˜¯ç”Ÿæˆé™æ€æ–‡æ¡£ç«™ç‚¹æ‰€éœ€è¦çš„ã€‚

```
<span class="hljs-keyword">touch</span> src/PrimaryButton/<span class="hljs-built_in">index</span>.md
```

æ·»åŠ æ–‡æ¡£å†…å®¹ï¼Œå…·ä½“å†…å®¹æè¿°å¯ä»¥çœ‹å®˜ç½‘[MakeDowné…ç½®é¡¹](https://d.umijs.org/config/markdown)ï¼Œè¿™é‡Œåªåœ¨æ³¨é‡Šé‡Œé¢è®²ä¸€ä¸‹ç”¨åˆ°çš„é…ç½®ã€‚

```

<span class="hljs-attr">category:</span> <span class="hljs-string">Components</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">PrimaryButton</span>
<span class="hljs-attr">toc:</span> <span class="hljs-string">content</span>
<span class="hljs-attr">group:</span>
  <span class="hljs-attr">title:</span> <span class="hljs-string">&#x4E8C;&#x6B21;&#x5C01;&#x88C5;&#x7EC4;&#x4EF6;</span>
  <span class="hljs-attr">order:</span> <span class="hljs-number">2</span>

<span class="hljs-string">&#x200B;</span>

<span class="hljs-string">&#x200B;</span>

<span class="hljs-string">&#x200B;</span>
<span class="hljs-string">&#x57FA;&#x7840;&#x7684;&#x6309;&#x94AE;&#x7EC4;&#x4EF6;</span> <span class="hljs-string">PrimaryButton&#x3002;</span>
<span class="hljs-string">&#x200B;</span>

<span class="hljs-string">&#x200B;</span>

<span class="hljs-string"><code< span> <span class="hljs-string">src="./demo/base.tsx">&#x57FA;&#x7840;&#x7528;&#x6CD5;</span></code<></span>
```

â€‹

â€‹

| å±æ€§ | ç±»å‹                   | é»˜è®¤å€¼   | å¿…å¡« | è¯´æ˜ |
| ---- | ---------------------- | -------- | ---- | ---- |
| size | 'small' | 'midlle' | 'large |  false  | æŒ‰é’®å¤§å° |

ç„¶åé‡å¯ä¸€ä¸‹dumi2é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šå·²ç»æœ‰æœ€æ–°æ·»åŠ çš„ç»„ä»¶äº†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba59ceceaeb74540aa2994b299850f36~tplv-k3u1fbpfcp-watermark.image?)

### 4.4 æ·»åŠ å•å…ƒæµ‹è¯•

åœ¨PrimaryButtonç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `__tests__`æ–‡ä»¶å¤¹æ”¾ç½®å•å…ƒæµ‹è¯•ä»£ç ï¼Œåœ¨é‡Œé¢æ–°å»ºindex.test.tsxã€‚

```
mkdir src<span class="hljs-regexp">/PrimaryButton/</span>__tests__ && touch src<span class="hljs-regexp">/PrimaryButton/</span>__tests__<span class="hljs-regexp">/index.test.tsx</span>
```

åœ¨index.test.tsxæ–‡ä»¶ä¸­ç¼–å†™æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä»£ç 

```

&#x200B;
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">'@testing-library/react'</span>;
<span class="hljs-keyword">import</span> { ButtonProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> PrimaryButton <span class="hljs-keyword">from</span> <span class="hljs-string">'..'</span>;
&#x200B;
describe(<span class="hljs-string">'PrimaryButton&#x6309;&#x94AE;'</span>, () => {
  <span class="hljs-keyword">const</span> buttonProps: ButtonProps = {
    <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">onClick</span>: jest.fn(),
  };
&#x200B;
  it(<span class="hljs-string">'&#x6B63;&#x786E;&#x6E32;&#x67D3;&#x6309;&#x94AE;'</span>, () => {
    <span class="hljs-keyword">const</span> buttonText = <span class="hljs-string">'&#x70B9;&#x51FB;&#x6309;&#x94AE;'</span>;
    <span class="hljs-keyword">const</span> { getByRole } = render(
      <span class="xml"><span class="hljs-tag"><<span class="hljs-name">PrimaryButton</span> {<span class="hljs-attr">...buttonProps</span>}></span>{buttonText}<span class="hljs-tag">PrimaryButton</span>></span>,
    );
    <span class="hljs-keyword">const</span> buttonElement = getByRole(<span class="hljs-string">'button'</span>);
    expect(buttonElement.textContent).toBe(buttonText);
  });
&#x200B;
  it(<span class="hljs-string">'&#x6B63;&#x786E;&#x6E32;&#x67D3;&#x6309;&#x94AE;&#x9ED8;&#x8BA4;type'</span>, () => {
    <span class="hljs-keyword">const</span> { getByRole } = render(
      <span class="xml"><span class="hljs-tag"><<span class="hljs-name">PrimaryButton</span> {<span class="hljs-attr">...buttonProps</span>}></span>&#x70B9;&#x51FB;&#x6309;&#x94AE;<span class="hljs-tag">PrimaryButton</span>></span>,
    );
    <span class="hljs-keyword">const</span> buttonElement = getByRole(<span class="hljs-string">'button'</span>);
    expect(buttonElement.classList.contains(<span class="hljs-string">'ant-btn-primary'</span>)).toBe(<span class="hljs-literal">true</span>);
  });
});
```

ä¸€ä¸ªåŸºäºantd4äºŒæ¬¡å¼€å‘ç®€å•ç»„ä»¶å°±å°è£…å¥½äº†ï¼Œç”±äºåœ¨å°è£…çš„æ—¶å€™æ²¡æœ‰å¼•å…¥antdåŸButtonç»„ä»¶çš„æ ·å¼ï¼Œæ‰“åŒ…åä¼šå‡ºç°æ ·å¼ä¸¢å¤±é—®é¢˜ï¼Œåœ¨æœ€åæ‰“åŒ…ç« èŠ‚ä¼šæœ‰å¤„ç†æ–¹å¼ã€‚

## äº”. å¼€å‘å·¥å…·å‡½æ•°

dum2ié™¤äº†å¼€å‘ç»„ä»¶åº“ä¹‹å¤–ï¼Œä¹Ÿèƒ½å¼€å‘å‡½æ•°åº“ï¼Œå¼€å‘å‡½æ•°åº“è¦æ¯”ç»„ä»¶åº“ç®€å•å¾ˆå¤šï¼Œè€Œä¸”ä¸é™åˆ¶å‰ç«¯æ¡†æ¶ï¼Œvueï¼Œreacté‡Œé¢éƒ½èƒ½ä½¿ç”¨ã€‚

### 5.1 æ·»åŠ å·¥å…·å‡½æ•°ä»£ç 

å†™ä¸€ä¸ªæ—¶é—´æ ¼å¼åŒ–çš„å·¥å…·å‡½æ•°ï¼Œåœ¨srcä¸‹æ–°å»ºä¸€ä¸ªformatTimeæ–‡ä»¶å¤¹ï¼Œæ–°å¢index.tsã€‚

```
<span class="hljs-built_in">mkdir</span> src/formatTime && touch src/formatTime/<span class="hljs-built_in">index</span>.<span class="hljs-keyword">ts</span>
```

åœ¨index.tsé‡Œé¢ç¼–å†™ä»£ç ï¼š

```

&#x200B;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatTime</span>(<span class="hljs-params">timestamp: number, format='YYYY-MM-DD hh:mm:ss'</span>): <span class="hljs-title">string</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-built_in">date</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(timestamp);
  <span class="hljs-keyword">const</span> year = <span class="hljs-built_in">date</span>.getFullYear();
  <span class="hljs-keyword">const</span> month = (<span class="hljs-string">'0'</span> + (<span class="hljs-built_in">date</span>.getMonth() + <span class="hljs-number">1</span>)).slice(<span class="hljs-number">-2</span>);
  <span class="hljs-keyword">const</span> day = (<span class="hljs-string">'0'</span> + <span class="hljs-built_in">date</span>.getDate()).slice(<span class="hljs-number">-2</span>);
  <span class="hljs-keyword">const</span> hours = (<span class="hljs-string">'0'</span> + <span class="hljs-built_in">date</span>.getHours()).slice(<span class="hljs-number">-2</span>);
  <span class="hljs-keyword">const</span> minutes = (<span class="hljs-string">'0'</span> + <span class="hljs-built_in">date</span>.getMinutes()).slice(<span class="hljs-number">-2</span>);
  <span class="hljs-keyword">const</span> seconds = (<span class="hljs-string">'0'</span> + <span class="hljs-built_in">date</span>.getSeconds()).slice(<span class="hljs-number">-2</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-attribute">map</span>: { [<span class="hljs-attribute">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> } = {
    <span class="hljs-attribute">YYYY</span>: <span class="hljs-built_in">String</span>(year),
    <span class="hljs-attribute">MM</span>: month,
    <span class="hljs-attribute">DD</span>: day,
    <span class="hljs-attribute">hh</span>: hours,
    <span class="hljs-attribute">mm</span>: minutes,
    <span class="hljs-attribute">ss</span>: seconds,
  };
  <span class="hljs-keyword">return</span> format.replace(<span class="hljs-regexp">/YYYY|MM|DD|hh|mm|ss/g</span>, (matched) => map[matched]);
}
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> formatTime;
```

ç»„ä»¶æºä»£ç æ·»åŠ å¥½åï¼Œéœ€è¦åœ¨src/index.tsä¸­å¼•å…¥åæš´éœ²ä¸€ä¸‹ï¼š

```

<span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> formatTime } <span class="hljs-keyword">from</span> <span class="hljs-string">'./formatTime'</span>;
```

åœ¨è¿™é‡Œå¼•å…¥å¹¶æš´éœ²å‡ºå»ä»¥åï¼Œdumiä¼šå¸®æˆ‘é—¨æ”¾åœ¨åŒ…åç§°dumi2-demoé‡Œé¢ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®ä¸­é€šè¿‡

`import { formatTime } from 'dumi2-demo';`æ¥å¼•å…¥äº†ã€‚

### 5.2 **æ·»åŠ demoç¤ºä¾‹**

åœ¨formatTimeç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªdemoæ–‡ä»¶å¤¹ï¼Œå†…å»ºä¸€ä¸ªåŸºç¡€æ¼”ç¤ºbase.tsxæ–‡ä»¶:

```

<span class="hljs-keyword">import</span> React, { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { formatTime } <span class="hljs-keyword">from</span> <span class="hljs-string">'dumi2-demo'</span>;
&#x200B;
<span class="hljs-keyword">const</span> App: React.FC = <span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  <span class="hljs-keyword">const</span> [currentDate, setCurrentDate] = useState(formatTime(<span class="hljs-built_in">Date</span>.now(), <span class="hljs-string">'YYYY&#x5E74;MM&#x6708;DD&#x65E5; hh:mm:ss'</span>));
  <span class="hljs-keyword">const</span> [siteDate, setSiteDate] = useState<string>();
&#x200B;
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {

    <span class="hljs-keyword">const</span> timestamp=<span class="hljs-number">1673850986000</span>
    <span class="hljs-keyword">const</span> siteStr: string = formatTime(timestamp);
    setSiteDate(siteStr);
  }, []);
&#x200B;
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {

    <span class="hljs-keyword">const</span> timer = setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
      <span class="hljs-keyword">const</span> date = <span class="hljs-built_in">Date</span>.now();
      <span class="hljs-keyword">const</span> dateStr = formatTime(date, <span class="hljs-string">'YYYY&#x5E74;MM&#x6708;DD&#x65E5; hh:mm:ss'</span>);
      setCurrentDate(dateStr);
    }, <span class="hljs-number">1000</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =></span> {
      clearInterval(timer);
    }
  }, []);
&#x200B;
  <span class="hljs-keyword">const</span> inputRef = React.createRef<htmlinputelement>();
  <span class="hljs-keyword">const</span> onFormatData = <span class="hljs-function"><span class="hljs-params">()</span> =></span> {
    <span class="hljs-keyword">const</span> value = inputRef.current?.value;
    <span class="hljs-keyword">if</span> (value) {
      <span class="hljs-keyword">const</span> dateStr = formatTime(<span class="hljs-built_in">Number</span>(value), <span class="hljs-string">'YYYY&#x5E74;MM&#x6708;DD&#x65E5; hh:mm:ss'</span>);
      setSiteDate(dateStr);
    }
  };
&#x200B;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag"><></span>
      &#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF1A;{currentDate}
      <span class="hljs-tag"><<span class="hljs-name">hr</span> /></span>
      &#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x8F6C;&#x6362;&#xFF1A;
      <span class="hljs-tag"><<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{1673850986000}</span> /></span>
      <span class="hljs-tag"><<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'button'</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onFormatData}</span>></span>&#x8F6C;&#x6362;<span class="hljs-tag">button</span>></span>
      {siteDate}
    <span class="hljs-tag"></></span>
  );
};
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;
</htmlinputelement></string>
```

### 5.3 æ·»åŠ å·¥å…·æ–‡æ¡£

åœ¨formatTimeç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªindex.mdæ–‡ä»¶:

```
---
category: Components
title: &#x65F6;&#x95F4;&#x683C;&#x5F0F;&#x5316;
toc: content
group:
  title: &#x5DE5;&#x5177;&#x51FD;&#x6570;
  order: 3
---
&#x200B;

&#x200B;
&#x5C06;&#x65F6;&#x95F4;&#x6233;&#x683C;&#x5F0F;&#x5316;&#x6210;&#x6307;&#x5B9A;&#x7684;&#x65E5;&#x671F;&#x65F6;&#x95F4;&#x683C;&#x5F0F;&#x3002;
&#x200B;

&#x200B;

&#x200B;
&#x57FA;&#x7840;&#x7528;&#x6CD5;
```

â€‹

â€‹
| å‚æ•°å    | ç±»å‹   | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼                  | è¯´æ˜                                                       |
| --------- | ------ | -------- | ----------------------- | ---------------------------------------------------------- |
| timestamp | number | æ˜¯       | -                       | è¦æ ¼å¼åŒ–çš„æ—¶é—´æˆ³ï¼Œå•ä½ä¸ºæ¯«ç§’                               |
| format    | string | å¦       | `'YYYY-MM-DD hh:mm:ss'` | è¦æ ¼å¼åŒ–æˆçš„æ—¥æœŸæ—¶é—´æ ¼å¼ï¼Œé»˜è®¤ä¸º `'YYYY-MM-DD hh:mm:ss'`ã€‚ |
â€‹

â€‹
ç±»å‹ï¼šstring
æ ¼å¼åŒ–åçš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ã€‚

ç„¶åé‡å¯ä¸€ä¸‹dumié¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢ä¸Šå·²ç»æœ‰æœ€æ–°æ·»åŠ çš„formatTimeå‡½æ•°äº†ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3193fd15a0c24320857c723868689e8a~tplv-k3u1fbpfcp-watermark.image?)

### 5.4 æ·»åŠ å•å…ƒæµ‹è¯•

åœ¨formatTimeç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `__tests__`æ–‡ä»¶å¤¹æ”¾ç½®å•å…ƒæµ‹è¯•ä»£ç ï¼Œåœ¨é‡Œé¢æ–°å»ºindex.test.tsxã€‚

åœ¨index.test.tsxæ–‡ä»¶ä¸­ç¼–å†™æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä»£ç 

```

<span class="hljs-keyword">import</span> formatTime <span class="hljs-keyword">from</span> <span class="hljs-string">'..'</span>;
&#x200B;
describe(<span class="hljs-string">'formatTime'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  it(<span class="hljs-string">'&#x6B63;&#x786E;&#x683C;&#x5F0F;&#x5316;&#x6307;&#x5B9A;&#x65F6;&#x95F4;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =></span> {
    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-number">1681216363389</span>;
    <span class="hljs-keyword">const</span> formattedDate = formatTime(timestamp, <span class="hljs-string">'YYYY&#x5E74;MM&#x6708;DD&#x65E5; hh&#x65F6;mm&#x5206;ss&#x79D2;'</span>);
    expect(formattedDate).toEqual(<span class="hljs-string">'2023&#x5E74;04&#x6708;11&#x65E5; 20&#x65F6;32&#x5206;43&#x79D2;'</span>);
  });
&#x200B;
  it(<span class="hljs-string">'&#x9ED8;&#x8BA4;&#x683C;&#x5F0F;&#x5316;&#x6307;&#x5B9A;&#x65F6;&#x95F4;'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =></span> {
    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-number">1681216363389</span>;
    <span class="hljs-keyword">const</span> formattedDate = formatTime(timestamp);
    expect(formattedDate).toEqual(<span class="hljs-string">'2023-04-11 20:32:43'</span>);
  });
});
```

åˆ°è¿™é‡Œå·¥å…·å‡½æ•°åº“çš„ç¤ºä¾‹ä¹Ÿå°±æ·»åŠ æˆåŠŸäº†ã€‚

## å…­. jestå•å…ƒæµ‹è¯•ä¼˜åŒ–

åˆšæ‰å¼€å‘äº†ä¸¤ä¸ªç»„ä»¶å’Œä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œå¹¶ä¸”éƒ½ç¼–å†™äº†jestå•å…ƒæµ‹è¯•ï¼Œç°åœ¨å†æ¥æ‰§è¡Œä¸€ä¸‹npx jestçœ‹ä¸€ä¸‹æ•ˆæœ:

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef20ed8ec50748da9979a91b2ccc2c20~tplv-k3u1fbpfcp-watermark.image?)

å¯ä»¥çœ‹åˆ°æ¯ä¸ªå•å…ƒæµ‹è¯•æ‰§è¡Œæƒ…å†µå’Œè¦†ç›–ç‡ã€‚

### 6.1 å…¨é‡å•å…ƒæµ‹è¯•

æ¯æ¬¡æ‰‹åŠ¨æ‰§è¡Œæ‰§è¡Œnpxä¸å¤ªæ–¹ä¾¿ï¼Œå¯ä»¥æŠŠå‘½ä»¤æ·»åŠ åœ¨package.jsonçš„è„šæœ¬scriptæ ‡ç­¾é‡Œé¢ã€‚

```

&#x200B;
<span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"test:all"</span>: <span class="hljs-string">"jest --coverage --bail"</span>
}
```

jestçš„å‘½ä»¤å‚æ•°:

* --bail: é‡åˆ°æµ‹è¯•ç”¨ä¾‹å¤±è´¥æ—¶ç«‹å³åœæ­¢æµ‹è¯•ï¼Œä¸å†æ‰§è¡Œå‰©ä½™çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥èŠ‚çœæ—¶é—´ã€‚
* --coverageï¼šç”Ÿæˆå•å…ƒæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šã€‚
* --findRelatedTests: å¯ä»¥æŒ‡å®šè¦æ‰§è¡Œçš„å•å…ƒæµ‹è¯•æ–‡ä»¶ã€‚

å†æ¬¡æ‰§è¡Œnpm run test:allå°±å¯ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•äº†ã€‚

### 6.2 æŒ‰éœ€å•å…ƒæµ‹è¯•

ç›´æ¥npx jestçš„æ–¹å¼æ˜¯å…¨é‡è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œä½†åœ¨æ­£å¸¸å¼€å‘è¿‡ç¨‹ä¸­ä¸€èˆ¬åªéœ€è¦æµ‹è¯•æˆ‘ä»¬ä¿®æ”¹äº†çš„æ–¹æ³•ï¼Œä¸éœ€è¦æ¯ä¸€æ¬¡éƒ½è¿›è¡Œå…¨é‡æµ‹è¯•ï¼Œå¯ä»¥æœ‰æ•ˆèŠ‚çœæ—¶é—´ã€‚

å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªè„šæœ¬ï¼Œé€šè¿‡git diff --staged --diff-filter=ACMR --name-onlyå‘½ä»¤è·å–åˆ°æœ¬æ¬¡ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åè¿›è¡Œåˆ†æéœ€è¦æ‰§è¡Œå“ªäº›å•å…ƒæµ‹è¯•ï¼Œé€šè¿‡--findRelatedTestså‚æ•°å»ç²¾å‡†æ‰§è¡Œå¯¹åº”çš„å•å…ƒæµ‹è¯•æ–‡ä»¶ã€‚

æŒ‰è¿™ä¸ªæ€è·¯åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºjest.staged.jsï¼Œæ·»åŠ ä»£ç ï¼š

```
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).promises;
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);
&#x200B;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span>() </span>{

  <span class="hljs-keyword">const</span> addFiles = execSync(<span class="hljs-string">`git diff --staged --diff-filter=ACMR --name-only`</span>)
    .toString()
    .split(<span class="hljs-string">'\n'</span>);

  <span class="hljs-keyword">const</span> diffFileList = addFiles
    .filter(<span class="hljs-built_in">Boolean</span>)
    .map(<span class="hljs-function">(<span class="hljs-params">item</span>) =></span> path.join(__dirname, item));
&#x200B;

  <span class="hljs-keyword">const</span> srcPath = path.join(__dirname, <span class="hljs-string">'./src'</span>);
&#x200B;

  <span class="hljs-keyword">const</span> diffFileMap = {};
  diffFileList.forEach(<span class="hljs-function">(<span class="hljs-params">filePath</span>) =></span> {
    <span class="hljs-keyword">if</span> (
      filePath.includes(srcPath) &&
      (filePath.endsWith(<span class="hljs-string">'.ts'</span>) || filePath.endsWith(<span class="hljs-string">'.tsx'</span>))
    ) {
      <span class="hljs-keyword">const</span> relativePath = path.relative(srcPath, filePath);
      <span class="hljs-keyword">if</span> (relativePath.includes(<span class="hljs-string">'/'</span>)) {
        diffFileMap[relativePath.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">0</span>]] = <span class="hljs-literal">true</span>;
      }
    }
  });
&#x200B;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'&#x672C;&#x6B21;&#x6539;&#x52A8;&#x7684;&#x65B9;&#x6CD5;'</span>, <span class="hljs-built_in">Object</span>.keys(diffFileMap));
&#x200B;

  <span class="hljs-keyword">const</span> list = (
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all(
      <span class="hljs-built_in">Object</span>.keys(diffFileMap).map(<span class="hljs-keyword">async</span> (toolPath) => {
        <span class="hljs-keyword">const</span> testsDir = path.join(srcPath, toolPath, <span class="hljs-string">'__tests__'</span>);
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> fs.readdir(testsDir);
          <span class="hljs-keyword">return</span> files.map(<span class="hljs-function">(<span class="hljs-params">item</span>) =></span> path.join(testsDir, item));
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-keyword">return</span> [];
        }
      }),
    )
  ).flat();
&#x200B;

  <span class="hljs-keyword">if</span> (list.length) {
    <span class="hljs-keyword">try</span> {
      execSync(<span class="hljs-string">`npx jest --bail --findRelatedTests <span class="hljs-subst">${list.join(<span class="hljs-regexp">/ /</span>)}</span>`</span>, {
        cwd: __dirname,
        stdio: <span class="hljs-string">'inherit'</span>,
      });
    } <span class="hljs-keyword">catch</span> (error) {
      process.exit(<span class="hljs-number">1</span>);
    }
  }
}
&#x200B;
start();
```

å†™å¥½è„šæœ¬ä»£ç åï¼Œåœ¨package.jsonçš„è„šæœ¬scriptæ ‡ç­¾é‡Œé¢ã€‚

```

&#x200B;
<span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"test:staged"</span>: <span class="hljs-string">"node jest.staged.js"</span>
}
```

ç„¶åæ¯æ¬¡ä¿®æ”¹ä»£ç æäº¤å‰éƒ½å¯ä»¥é€šè¿‡æ‰§è¡Œnpm run test:stagedæ¥ç²¾ç¡®æ‰§è¡Œä¿®æ”¹åˆ°çš„å•å…ƒæµ‹è¯•æ–‡ä»¶ã€‚

> å‰æé¡¹ç›®è¦git initï¼Œæœ‰.gitæ–‡ä»¶

ä¹Ÿå¯ä»¥æŠŠå‘½ä»¤åŠ åˆ°lint-stagedé‡Œé¢æ¯ä¸€æ¬¡æäº¤ä»£ç æ—¶è‡ªåŠ¨æ‰§è¡ŒæŒ‰éœ€æ‰§è¡Œjestå•å…ƒæµ‹è¯•ã€‚

lint-stagedåœ¨dumié¡¹ç›®åˆ›å»ºæ—¶å·²ç»é»˜è®¤å®‰è£…ä¾èµ–é…ç½®å¥½äº†ï¼Œæˆ‘ä»¬åªè¦ä¿®æ”¹ä¸€ä¸‹package.jsonçš„lint-stagedå­—æ®µå°±å¯ä»¥äº†ã€‚

```
// package.json
&#x200B;
<span class="hljs-string">"lint-staged"</span>: {
  <span class="hljs-string">"src/**/*.{md,json}"</span>: [
    <span class="hljs-string">"prettier --write --no-error-on-unmatched-pattern"</span>
  ],
  <span class="hljs-string">"src/**/*.{css,less}"</span>: [
    <span class="hljs-string">"stylelint --fix"</span>,
    <span class="hljs-string">"prettier --write"</span>
  ],
  <span class="hljs-string">"src/**/*.{ts, tsx}"</span>: [
    <span class="hljs-string">"eslint --fix"</span>,
    <span class="hljs-string">"prettier --parser=typescript --write"</span>,
    <span class="hljs-string">"npm run test:staged"</span>
  ]
},
```

å†æ”¹ä¸€ä¸‹.husky/pre-commitæ–‡ä»¶æŠŠé‡Œé¢çš„npx lint-stagedæ”¹ä¸ºnpx lint-staged -p true -vï¼Œè¿™æ ·æ‰èƒ½åœ¨æ‰§è¡Œlint-stagedçš„æ—¶å€™åœ¨æ§åˆ¶å°çœ‹åˆ°æ‰“å°çš„ä¿¡æ¯ã€‚

```

. <span class="hljs-string">"<span class="hljs-variable">$(dirname -- "$0")</span>/_/husky.sh"</span>
&#x200B;
npx lint-staged -v
```

ç°åœ¨æ¯æ¬¡git commitæäº¤ä»£ç å¦‚æœç»„ä»¶æˆ–å‡½æ•°ä»£ç æœ‰æ”¹åŠ¨ï¼Œä¼šé€šè¿‡lint-stagedè§¦å‘npm run test:stagedå‘½ä»¤ï¼Œç„¶åå†å†…éƒ¨ä½¿ç”¨gitè·å–åˆ°ä¿®æ”¹åˆ°çš„æ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œå»æ‰§è¡Œå¯¹åº”ç»„ä»¶æˆ–å·¥å…·å‡½æ•°ä¸‹é¢çš„jestå•å…ƒæµ‹è¯•ã€‚

## ä¸ƒ. æ‰“åŒ…éƒ¨ç½²

åœ¨ç»„ä»¶æˆ–è€…å·¥å…·å‡½æ•°å¼€å‘å®Œæˆåï¼Œå°±éœ€è¦è¿›è¡Œéƒ¨ç½²æ“ä½œäº†ï¼Œéƒ¨ç½²åˆ†ä¸ºä¸¤éƒ¨åˆ†éƒ¨ç½²ï¼š

ä¸€æ˜¯æ‰“åŒ…æ–‡æ¡£é™æ€ç«™ç‚¹æ–‡æ¡£ï¼Œè®©ç”¨æˆ·å¯ä»¥é€šè¿‡åŸŸåè®¿é—®åˆ°æ–‡æ¡£ç«™ç‚¹ï¼Œæ–¹ä¾¿å…¶ä½¿ç”¨ã€‚

äºŒæ˜¯æ‰“åŒ…ç»„ä»¶åº“æºç ï¼Œéƒ¨ç½²åˆ°npmä»“åº“ä¸Šé¢ï¼Œè®©å…¶ä»–äººå¯ä»¥é€šè¿‡npmå®‰è£…ä½¿ç”¨ã€‚

### 7.1 æ‰“åŒ…é™æ€ç«™ç‚¹

æ‰“åŒ…é™æ€ç«™ç‚¹dumi2åœ¨åˆ›å»ºé¡¹ç›®æ—¶å·²ç»é…ç½®å¥½äº†å‘½ä»¤ï¼Œåªéœ€è¦åœ¨æ§åˆ¶å°æ‰§è¡Œ

```
npm <span class="hljs-keyword">run</span><span class="bash"> docs:build</span>
```

æ‰“åŒ…å®Œæˆåä¼šåœ¨é¡¹ç›®ä¸­ç”Ÿæˆdocs-distæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹å°±æ˜¯éƒ¨ç½²é™æ€æ–‡æ¡£ç«™ç‚¹çš„é™æ€èµ„æºã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef8944e639bf4a5fbf32184a7e3a0669~tplv-k3u1fbpfcp-watermark.image?)

åœ¨æœ¬åœ°å¯ä»¥å€ŸåŠ©serveèµ·ä¸€ä¸ªæœåŠ¡æ‰˜ç®¡é™æ€è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œå…¨å±€å®‰è£…serve:

```
<span class="hljs-built_in">npm</span> i serve -g
```

å®‰è£…å®Œæˆååœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤æ‰˜ç®¡æ–‡æ¡£é™æ€ç«™ç‚¹ï¼š

```
<span class="hljs-attribute">serve -s docs-dist</span>
```

æ‰“å¼€æç¤ºçš„æœåŠ¡è®¿é—®é“¾æ¥[http://localhost:3000/](http://localhost:3000/)ï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®åˆ°æ‰“åŒ…åçš„é™æ€ç«™ç‚¹ï¼Œå®é™…æƒ…å†µä¸‹éœ€è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šé¢ï¼Œå¯ä»¥å€ŸåŠ©nginxæ¥éƒ¨ç½²ã€‚

### 7.2ä¼˜åŒ–é™æ€ç«™ç‚¹æ‰“åŒ…

åœ¨é™æ€ç«™ç‚¹é»˜è®¤é…ç½®ä¸‹ï¼Œä¼šæŠŠæ¯ä¸€ä¸ªç»„ä»¶æˆ–è€…å‡½æ•°å•ç‹¬æ‰“åŒ…ä¸€ä»½é™æ€æ–‡ä»¶åœ¨componentsæ–‡ä»¶å¤¹ä¸‹ï¼Œåœ¨ä¸Šå›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä½†å®é™…ä¸Šä¸€èˆ¬æ˜¯ä¸éœ€è¦å†å•ç‹¬ç”Ÿæˆä¸€ä»½çš„ï¼Œå¯ä»¥ä¿®æ”¹æ‰“åŒ…é…ç½®ï¼Œå–æ¶ˆæ‰“åŒ…å•ä¸ªé™æ€èµ„æºã€‚

ä¿®æ”¹.dumirc.tsæ–‡ä»¶

```
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'dumi'</span>;
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({

  <span class="hljs-attr">exportStatic</span>: <span class="hljs-literal">false</span>
});
```

å†æ¬¡æ‰“åŒ…å°±ä¸ä¼šç”Ÿæˆå•ä¸ªç»„ä»¶çš„æ–‡æ¡£ç«™ç‚¹äº†ï¼Œå¯ä»¥æœ‰æ•ˆèŠ‚çœæ‰“åŒ…æ—¶é—´å’Œæ‰“åŒ…ä½“ç§¯ã€‚

### 7.3 æ‰“åŒ…npmæºç åŒ…

é™æ€ç«™ç‚¹æ‰“åŒ…å¥½åï¼Œå°±éœ€è¦æ‰“åŒ…ç»„ä»¶å’Œå‡½æ•°åº“æœ€ç»ˆçš„npmåŒ…äº†ï¼Œdumi2ä¹Ÿåœ¨åˆ›å»ºé¡¹ç›®æ—¶å°±æä¾›äº†npmåŒ…æ‰“åŒ…çš„å‘½ä»¤ï¼Œç›´æ¥æ‰§è¡Œ:

```
npm <span class="hljs-keyword">run</span><span class="bash"> build</span>
```

æ‰“åŒ…å®Œæˆåä¼šåœ¨é¡¹ç›®ä¸­ç”Ÿæˆdistæ–‡ä»¶å¤¹ï¼Œè¯¥distæ–‡ä»¶å¤¹å°±æ˜¯æœ€ç»ˆè¦å‘å¸ƒåˆ°npmä»“åº“ä¸Šçš„æºç ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e428861a86fd4fa18d7c5b262e32c786~tplv-k3u1fbpfcp-watermark.image?)

å‘å¸ƒçš„æ—¶å€™é™¤äº†distæ–‡ä»¶ä¹‹å¤–ï¼Œè¿˜éœ€è¦åœ¨package.jsoné‡Œé¢åšé…ç½®:

æŠŠantdæ·»åŠ åˆ°ï¼Œè¡¨ç¤ºä½¿ç”¨è¯¥ç»„ä»¶åº“ï¼Œå¿…é¡»è¦å…ˆå®‰è£…antdå¯¹åº”ç‰ˆæœ¬ã€‚

```
<span class="hljs-string">"peerDependencies"</span>: {
  <span class="hljs-string">"react"</span>: <span class="hljs-string">">=16.9.0"</span>,
  <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">">=16.9.0"</span>,
  <span class="hljs-string">"antd"</span>: <span class="hljs-string">">=5.4.2"</span>
},
```

package.jsonçš„nameå­—æ®µå¯¹åº”npmåŒ…çš„ç‰ˆæœ¬å·ï¼Œç¬¬ä¸€æ¬¡å‘å¯ä»¥0.0.1ï¼Œåé¢å†å‘å°±éœ€è¦ä¿®æ”¹ç‰ˆæœ¬å·ã€‚

å…¶ä»–çš„å­—æ®µfileså’Œmoduleï¼Œtypesåœ¨é¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™dumiå°±å¸®æˆ‘ä»¬è®¾ç½®å¥½äº†ã€‚

ç„¶åå»npmå®˜ç½‘æ³¨å†Œè´¦å·ï¼Œåœ¨å‘½ä»¤è¡Œé€šè¿‡npm loginè¿›è¡Œç™»å½•ï¼Œæœ€åå›åˆ°é¡¹ç›®ç›®å½•ï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥

```
<span class="hljs-built_in">npm</span> publish
```

å°±å¯ä»¥å‘å¸ƒåˆ°npmä»“åº“äº†ã€‚

### 7.4 ä¼˜åŒ–npmæºç æ‰“åŒ…

åœ¨ä¸Šé¢æ‰“åŒ…æºç åŒ…å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å‡½æ•°æºç ä¸‹é¢ä¾ç„¶æœ‰demoæ–‡ä»¶å¤¹ï¼Œä½†å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šç”¨åˆ°çš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®åœ¨æ‰“åŒ…npmæºç åŒ…çš„æ—¶å€™æŠŠdemoæ–‡ä»¶å¤¹è¿‡æ»¤æ‰ã€‚

å› ä¸ºæ‰“åŒ…npmæºç æ˜¯ç”¨fatheræ¥æ‰“åŒ…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹.fatherrc.tsé…ç½®æ–‡ä»¶:

```
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'father'</span>;
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({
  <span class="hljs-attr">esm</span>: {

    <span class="hljs-attr">ignores</span>: [
      <span class="hljs-string">'src/**/demo/**'</span>,
    ],
  },

});
&#x200B;
```

å†ä¸€æ¬¡æ‰“åŒ…å°±ä¼šå‘ç°demoæ–‡ä»¶å¤¹ä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆçš„npmåŒ…distæ–‡ä»¶å¤¹é‡Œé¢äº†ã€‚

### 7.5 è§£å†³antdæ‰“åŒ…npmåæ²¡æœ‰æ ·å¼

ä¸Šé¢è™½ç„¶åŸºäºantdå°è£…å¥½äº†æŒ‰é’®ï¼Œåœ¨æ–‡æ¡£é¢„è§ˆæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨æŠŠnpmåŒ…å¼•å…¥ä½¿ç”¨çš„æ—¶å€™ä¼šå‡ºç°æ ·å¼ä¸¢å¤±çš„é—®é¢˜ï¼Œæœ‰ä¸‰ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆã€‚

1. ç›´æ¥å…¨å±€å¼•å…¥antdçš„æ ·å¼ï¼Œä½†è¿™æ ·è™½ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä¼šå¼•å…¥å¾ˆå¤šä¸å¿…è¦çš„cssèµ„æºï¼Œå¢åŠ é¡¹ç›®ä½“ç§¯ï¼Œæ‰€ä»¥ä¸æ¨èã€‚
2. åœ¨äºŒæ¬¡å°è£…çš„ç»„ä»¶å†…æ‰‹æ®µå¼•å…¥å¯¹åº”antdç»„ä»¶çš„æ ·å¼ï¼Œè¿™æ ·è™½ç„¶å¯ä»¥è§£å†³æ ·å¼ä¸¢å¤±é—®é¢˜ï¼Œå¹¶ä¸”æ”¯æŒæŒ‰éœ€å¼•å…¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨åŠ æ¯”è¾ƒéº»çƒ¦ã€‚
3. å¯ä»¥åœ¨npmåŒ…æ‰“åŒ…é…ç½®.fatherrc.tsæ·»åŠ antdæŒ‰éœ€å¼•å…¥cssçš„é…ç½®ï¼Œå®‰è£…æŒ‰éœ€å¼•å…¥ä¾èµ–ï¼š

```
<span class="hljs-built_in">npm</span> i babel-plugin-<span class="hljs-keyword">import</span> -D
```

ç„¶ååœ¨.fatherrc.tsæ·»åŠ extraBabelPluginsé…ç½®

```
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'father'</span>
&#x200B;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({

  <span class="hljs-attr">extraBabelPlugins</span>: [
    [
      <span class="hljs-string">'babel-plugin-import'</span>,
      {
        <span class="hljs-attr">libraryName</span>: <span class="hljs-string">'antd'</span>,
        <span class="hljs-attr">libraryDirectory</span>: <span class="hljs-string">'es'</span>,
        <span class="hljs-attr">style</span>: <span class="hljs-literal">true</span>,
      },
    ],
  ],
})
```

æ·»åŠ é…ç½®åæ‰“åŒ…npmåŒ…å°±ä¼šæ·»åŠ ä¸Šantdçš„æ ·å¼äº†ã€‚

### 7.6 è§£å†³ç»„ä»¶ä¸èƒ½æŒ‰éœ€å¼•å…¥

åœ¨å‘å¸ƒåˆ°npmä¸Šé¢åæœ¬åœ°å®‰è£…ä½¿ç”¨æ—¶å‘ç°ç»„ä»¶åº“æ²¡æœ‰tree-shakingæ•ˆæœã€‚

```
<span class="hljs-built_in">npm</span> i dumi2-demo -S
&#x200B;
<span class="hljs-keyword">import</span> { PrimaryButton } <span class="hljs-keyword">from</span> <span class="hljs-string">'dumi2-demo'</span>
```

é—®é¢˜åŸå› æ˜¯ç”±æ ·å¼lessæ–‡ä»¶å¼•èµ·çš„ï¼Œæ„å»ºå·¥å…·è®¤ä¸ºæ ·å¼æœ‰å‰¯ä½œç”¨ï¼Œæ‰€ä»¥æ²¡æœ‰è¿›è¡Œtree-shakingæ“ä½œï¼Œè§£å†³æ–¹æ¡ˆåªéœ€è¦åœ¨dmi2ç»„ä»¶ä»£ç çš„package.jsoné‡Œé¢åŠ ä¸ŠsideEffetï¼Œå‘Šè¯‰æ„å»ºå·¥å…·è¿™ä¸ªnpmåŒ…æ²¡æœ‰å‰¯ä½œç”¨å¯ä»¥è¿›è¡Œtree-shakingã€‚

ä¿®æ”¹ç»„ä»¶åº“çš„package.jsonï¼Œæ·»åŠ ï¼š

```
{

  <span class="hljs-attr">"slideEffects"</span>: <span class="hljs-literal">false</span>,
}
```

ä¿®æ”¹åä½¿ç”¨ç»„ä»¶å°±ä¼šæŒ‰éœ€åŠ è½½ï¼Œæœ‰tree-shkingæ•ˆæœäº†ã€‚

## å…«. æ€»ç»“

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€ä¸ªåŸºç¡€çš„ç»„ä»¶åº“å’Œå‡½æ•°åº“demoå°±å¼€å‘å¥½äº†ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¿˜æœ‰å¾…ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç°åœ¨æ‰“åŒ…çš„æ˜¯esæ¨¡å—ï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šéœ€è¦æ”¯æŒcommonæ¨¡å—å’Œåœ¨æµè§ˆå™¨ä¸Šé¢ç›´æ¥ä½¿ç”¨çš„umdï¼Œä»¥åŠæ‰“åŒ…æ—¶æŠŠlessç¼–è¯‘ä¸ºcssï¼Œè¿˜æœ‰å¼€å‘ç§»åŠ¨ç«¯çš„ç»„ä»¶ã€‚

æœ¬æ–‡æ˜¯æ€»ç»“è‡ªå·±åœ¨å·¥ä½œä¸­ä½¿ç”¨dumi2æ­å»ºç»„ä»¶åº“å’Œå‡½æ•°åº“ä¸­ä½¿ç”¨åˆ°çš„é…ç½®, ä¹Ÿå¾ˆå¤šæ²¡æœ‰åšå¥½çš„åœ°æ–¹ï¼Œåç»­æœ‰å¥½çš„ä½¿ç”¨æŠ€å·§å’Œé…ç½®ä¹Ÿä¼šç»§ç»­æ›´æ–°è®°å½•ï¼Œé™„ä¸Šæœ¬æ–‡demoç›¸å…³çš„åœ°å€ï¼š

demoé™æ€æ–‡æ¡£ç«™ç‚¹åœ°å€ï¼š[https://dumi2.guojiongwei.top](https://dumi2.guojiongwei.top)

demoæºç githubåœ°å€ï¼š[https://github.com/guojiongwei/dumi2-demo](https://github.com/guojiongwei/dumi2-demo)

demo npmåŒ…åœ°å€ï¼š[https://www.npmjs.com/package/dumi2-demo](https://www.npmjs.com/package/dumi2-demo)

å¾€æœŸå‰ç«¯å·¥ç¨‹åŒ–ç³»åˆ—æ–‡ç« :

[ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘webpack5ä»é›¶æ­å»ºå®Œæ•´çš„react18+tså¼€å‘å’Œæ‰“åŒ…ç¯å¢ƒ](https://juejin.cn/post/7111922283681153038)

[ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘é…ç½®React+tsé¡¹ç›®å®Œæ•´çš„ä»£ç åŠæ ·å¼æ ¼å¼å’Œgitæäº¤è§„èŒƒ](https://juejin.cn/post/7101596844181962788)

[ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ä½¿ç”¨verdaccioæ­å»ºå…¬å¸npmç§æœ‰åº“å®Œæ•´æµç¨‹å’Œè¸©å‘è®°å½•](https://juejin.cn/post/7096701542408912933)

[ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘vue2+webpack3è€é¡¹ç›®è¿ç§»vite2æµç¨‹å’Œè¸©å‘æ€»ç»“](https://juejin.cn/post/7094130826471964708)
